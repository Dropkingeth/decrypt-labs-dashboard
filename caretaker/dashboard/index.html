<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Decrypt Labs ‚Äî Mission Control</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöÄ</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
  <style>
    :root {
      --bg-dark: #0a0a12;
      --bg-card: rgba(255,255,255,0.03);
      --bg-card-hover: rgba(255,255,255,0.06);
      --accent-cyan: #00d4ff;
      --accent-green: #00ff88;
      --accent-red: #ff4455;
      --accent-orange: #ffaa00;
      --accent-purple: #aa66ff;
      --accent-yellow: #ffdd44;
      --text-primary: #ffffff;
      --text-secondary: #88889a;
      --text-dim: #555566;
      --border-color: rgba(255,255,255,0.08);
      --border-glow-cyan: rgba(0,212,255,0.3);
      --border-glow-green: rgba(0,255,136,0.3);
      --border-glow-purple: rgba(170,102,255,0.3);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* === PASSWORD GATE === */
    #auth-gate {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: var(--bg-dark);
      display: flex; align-items: center; justify-content: center;
      z-index: 99999;
      transition: opacity 0.4s ease;
    }
    #auth-gate.hidden { opacity: 0; pointer-events: none; }
    .auth-box {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 48px 40px;
      text-align: center;
      max-width: 380px;
      width: 90%;
      backdrop-filter: blur(20px);
      box-shadow: 0 0 60px rgba(0,212,255,0.05);
    }
    .auth-box .auth-icon { font-size: 48px; margin-bottom: 16px; }
    .auth-box h2 {
      font-family: 'Orbitron', monospace;
      font-size: 18px;
      color: var(--accent-cyan);
      margin-bottom: 6px;
      letter-spacing: 2px;
    }
    .auth-box .auth-sub {
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 28px;
    }
    .auth-box input {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      color: var(--text-primary);
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s;
      margin-bottom: 16px;
    }
    .auth-box input:focus { border-color: var(--accent-cyan); }
    .auth-box input::placeholder { color: var(--text-dim); }
    .auth-box button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
      border: none;
      border-radius: 8px;
      color: #000;
      font-family: 'Orbitron', monospace;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 2px;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    .auth-box button:hover { opacity: 0.85; }
    .auth-box .auth-error {
      color: var(--accent-red);
      font-size: 11px;
      margin-top: 12px;
      min-height: 16px;
    }
    .auth-box .auth-lock {
      font-size: 10px;
      color: var(--text-dim);
      margin-top: 16px;
    }

    body {
      font-family: 'JetBrains Mono', monospace;
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(0,212,255,0.03) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(170,102,255,0.03) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(0,255,136,0.02) 0%, transparent 60%);
      pointer-events: none;
      z-index: 0;
    }

    h1, h2, h3, h4, h5, h6, .font-heading {
      font-family: 'Orbitron', sans-serif;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAV BAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .navbar {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(10,10,18,0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      padding: 0 16px;
      height: 52px;
      gap: 2px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .navbar::-webkit-scrollbar { height: 0; }

    .nav-tab {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
      white-space: nowrap;
      transition: all 0.2s;
      border: 1px solid transparent;
      font-family: 'JetBrains Mono', monospace;
    }

    .nav-tab:hover {
      color: var(--text-primary);
      background: rgba(255,255,255,0.05);
    }

    .nav-tab.active {
      color: var(--text-primary);
      background: rgba(255,255,255,0.08);
      border-color: var(--border-color);
    }

    .nav-tab .icon { font-size: 15px; }

    .nav-spacer { flex: 1; }

    .server-status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-secondary);
      padding: 4px 10px;
      border-radius: 20px;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border-color);
      white-space: nowrap;
    }

    .status-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      display: inline-block;
      flex-shrink: 0;
    }

    .status-dot.green { background: var(--accent-green); box-shadow: 0 0 6px var(--accent-green); }
    .status-dot.yellow { background: var(--accent-yellow); box-shadow: 0 0 6px var(--accent-yellow); }
    .status-dot.red { background: var(--accent-red); box-shadow: 0 0 6px var(--accent-red); }
    .status-dot.grey { background: #555; }
    .status-dot.orange { background: var(--accent-orange); box-shadow: 0 0 6px var(--accent-orange); }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN CONTENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .main-content {
      position: relative;
      z-index: 1;
      padding: 24px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .section-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .section-subtitle {
      color: var(--text-secondary);
      font-size: 13px;
      margin-bottom: 24px;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CARDS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.2s;
    }

    .card:hover {
      background: var(--bg-card-hover);
      border-color: rgba(255,255,255,0.12);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .card-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB 1: MISSION CONTROL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 2px;
    }

    .stat-card.cyan::before { background: linear-gradient(90deg, var(--accent-cyan), transparent); }
    .stat-card.green::before { background: linear-gradient(90deg, var(--accent-green), transparent); }
    .stat-card.purple::before { background: linear-gradient(90deg, var(--accent-purple), transparent); }
    .stat-card.orange::before { background: linear-gradient(90deg, var(--accent-orange), transparent); }

    .stat-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .stat-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 28px;
      font-weight: 700;
    }

    .stat-card.cyan .stat-value { color: var(--accent-cyan); }
    .stat-card.green .stat-value { color: var(--accent-green); }
    .stat-card.purple .stat-value { color: var(--accent-purple); }
    .stat-card.orange .stat-value { color: var(--accent-orange); }

    .stat-change {
      font-size: 11px;
      margin-top: 4px;
      color: var(--text-dim);
    }

    .stat-change.positive { color: var(--accent-green); }
    .stat-change.negative { color: var(--accent-red); }

    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    @media (max-width: 900px) {
      .dashboard-grid { grid-template-columns: 1fr; }
    }

    .upcoming-task {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid var(--border-color);
      font-size: 13px;
    }

    .upcoming-task:last-child { border-bottom: none; }

    .upcoming-task-name { color: var(--text-primary); }
    .upcoming-task-time { color: var(--text-dim); font-size: 11px; }

    /* Projects completed list */
    .project-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 0;
      border-bottom: 1px solid var(--border-color);
      font-size: 13px;
    }
    .project-item:last-child { border-bottom: none; }
    .project-check { color: var(--accent-green); font-size: 14px; flex-shrink: 0; }
    .project-name { color: var(--text-primary); }

    /* Team badge */
    .team-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 14px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border-color);
    }
    .team-badge .role { color: var(--text-dim); font-weight: 400; font-size: 11px; }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB 2: TASKS (KANBAN) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .kanban-board {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      min-height: 500px;
    }

    @media (max-width: 1000px) {
      .kanban-board { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 600px) {
      .kanban-board { grid-template-columns: 1fr; }
    }

    .kanban-column {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
      min-height: 400px;
    }

    .kanban-column-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border-color);
    }

    .kanban-column-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .kanban-count {
      font-size: 11px;
      background: rgba(255,255,255,0.08);
      padding: 2px 8px;
      border-radius: 10px;
      color: var(--text-secondary);
    }

    .task-card {
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 14px;
      margin-bottom: 10px;
      cursor: grab;
      transition: all 0.2s;
    }

    .task-card:hover {
      background: rgba(255,255,255,0.07);
      border-color: rgba(255,255,255,0.15);
      transform: translateY(-1px);
    }

    .task-card.dragging {
      opacity: 0.5;
      transform: rotate(2deg);
    }

    .task-title { font-size: 13px; font-weight: 600; margin-bottom: 6px; }
    .task-desc { font-size: 11px; color: var(--text-secondary); margin-bottom: 10px; line-height: 1.4; }

    .task-meta {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }

    .task-tag {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .task-tag.high { background: rgba(255,68,85,0.15); color: var(--accent-red); border: 1px solid rgba(255,68,85,0.3); }
    .task-tag.medium { background: rgba(255,170,0,0.15); color: var(--accent-orange); border: 1px solid rgba(255,170,0,0.3); }
    .task-tag.low { background: rgba(0,212,255,0.15); color: var(--accent-cyan); border: 1px solid rgba(0,212,255,0.3); }

    .task-assignee {
      font-size: 10px;
      color: var(--text-dim);
      margin-left: auto;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB 3: CALENDAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .calendar-controls {
      display: flex;
      gap: 8px;
    }

    .cal-btn {
      padding: 6px 14px;
      border: 1px solid var(--border-color);
      background: rgba(255,255,255,0.05);
      color: var(--text-primary);
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
      font-family: 'JetBrains Mono', monospace;
      transition: all 0.2s;
    }

    .cal-btn:hover { background: rgba(255,255,255,0.1); }
    .cal-btn.active { background: rgba(0,212,255,0.15); border-color: var(--accent-cyan); color: var(--accent-cyan); }

    .always-running {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 20px;
    }

    .always-running-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--accent-cyan);
    }

    .always-running-pills {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .cron-pill {
      font-size: 11px;
      padding: 5px 12px;
      border-radius: 20px;
      background: rgba(0,212,255,0.12);
      border: 1px solid rgba(0,212,255,0.25);
      color: var(--accent-cyan);
    }

    /* Pipeline Status Board */
    .pipeline-step { position: relative; }
    .pipeline-node {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-left: 3px solid;
      border-radius: 10px;
      padding: 14px 16px;
      transition: all 0.2s;
    }
    .pipeline-node:hover { background: rgba(255,255,255,0.06); transform: translateX(4px); }
    .pipeline-header { display: flex; align-items: center; gap: 12px; margin-bottom: 6px; }
    .pipeline-icon {
      width: 36px; height: 36px; border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; flex-shrink: 0;
    }
    .pipeline-title { font-size: 13px; font-weight: 600; color: var(--text-primary); }
    .pipeline-agent { font-size: 11px; color: var(--text-secondary); margin-top: 2px; }
    .pipeline-status {
      font-size: 11px; color: var(--text-secondary);
      display: flex; align-items: center; gap: 6px; flex-shrink: 0;
      padding: 3px 10px; border-radius: 12px; background: rgba(0,255,136,0.08);
    }
    .pipeline-status .status-dot { width: 6px; height: 6px; }
    .pipeline-detail {
      font-size: 11px; color: var(--text-secondary); line-height: 1.6;
      padding: 4px 0 4px 48px;
    }
    .pipeline-detail code {
      background: rgba(0,212,255,0.1); padding: 1px 6px; border-radius: 4px;
      font-size: 10px; color: var(--accent-green);
    }
    .pipeline-meta {
      display: flex; flex-wrap: wrap; gap: 12px; padding: 4px 0 0 48px;
      font-size: 10px; color: rgba(255,255,255,0.35);
    }
    .pipeline-meta code { background: rgba(0,212,255,0.08); padding: 1px 5px; border-radius: 3px; font-size: 10px; }
    .pipeline-arrow {
      text-align: center; color: rgba(255,255,255,0.15); font-size: 14px;
      padding: 2px 0; line-height: 1;
    }
    @media (max-width: 768px) {
      .pipeline-detail, .pipeline-meta { padding-left: 0; }
      .pipeline-header { flex-wrap: wrap; }
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-bottom: 24px;
    }

    @media (max-width: 900px) {
      .calendar-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 500px) {
      .calendar-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .cal-day {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 12px;
      min-height: 220px;
    }

    .cal-day-name {
      font-family: 'Orbitron', sans-serif;
      font-size: 12px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--text-secondary);
    }

    .cal-event {
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 11px;
      margin-bottom: 6px;
      font-weight: 500;
      line-height: 1.3;
    }

    .cal-event .cal-event-time {
      font-size: 9px;
      opacity: 0.7;
      margin-top: 2px;
    }

    .cal-event.cyan { background: rgba(0,212,255,0.15); color: var(--accent-cyan); border-left: 3px solid var(--accent-cyan); }
    .cal-event.green { background: rgba(0,255,136,0.12); color: var(--accent-green); border-left: 3px solid var(--accent-green); }
    .cal-event.purple { background: rgba(170,102,255,0.15); color: var(--accent-purple); border-left: 3px solid var(--accent-purple); }
    .cal-event.orange { background: rgba(255,170,0,0.15); color: var(--accent-orange); border-left: 3px solid var(--accent-orange); }
    .cal-event.red { background: rgba(255,68,85,0.12); color: var(--accent-red); border-left: 3px solid var(--accent-red); }
    .cal-event.yellow { background: rgba(255,221,68,0.12); color: var(--accent-yellow); border-left: 3px solid var(--accent-yellow); }

    .countdown-section {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
    }

    .countdown-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 16px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .countdown-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid var(--border-color);
      font-size: 13px;
    }

    .countdown-item:last-child { border-bottom: none; }

    .countdown-label { display: flex; align-items: center; gap: 8px; }
    .countdown-label .dot { width: 6px; height: 6px; border-radius: 50%; }
    .countdown-value { color: var(--text-dim); font-size: 12px; }

    /* Monthly expenses */
    .expenses-section {
      margin-top: 24px;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
    }

    .expenses-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 16px;
      color: var(--accent-orange);
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .expense-table {
      width: 100%;
      border-collapse: collapse;
    }

    .expense-table th {
      font-family: 'Orbitron', sans-serif;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-dim);
      text-align: left;
      padding: 8px 12px;
      border-bottom: 1px solid var(--border-color);
    }

    .expense-table th:last-child { text-align: right; }

    .expense-table td {
      font-size: 13px;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
    }

    .expense-table tr:last-child td { border-bottom: none; }

    .expense-table td:last-child {
      text-align: right;
      font-family: 'Orbitron', sans-serif;
      font-weight: 600;
      color: var(--accent-orange);
    }

    .expense-table .expense-name { color: var(--text-primary); }
    .expense-table .expense-note { color: var(--text-dim); font-size: 11px; }
    .expense-table .expense-free { color: var(--accent-green); }

    .todo-note-input {
      width: 100%;
      padding: 4px 8px;
      margin-top: 4px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 4px;
      color: var(--text-secondary);
      font-size: 11px;
      font-family: 'JetBrains Mono', monospace;
      outline: none;
      transition: all 0.2s;
    }
    .todo-note-input:focus {
      border-color: var(--accent-cyan);
      background: rgba(0,212,255,0.06);
      color: var(--text-primary);
    }
    .todo-note-input::placeholder { color: rgba(255,255,255,0.2); }
    .todo-note-saved {
      font-size: 11px;
      color: var(--text-dim);
      margin-top: 4px;
      font-style: italic;
    }
    .todo-sent-badge {
      display: inline-block;
      font-size: 9px;
      padding: 1px 6px;
      border-radius: 3px;
      background: rgba(0,255,136,0.1);
      color: var(--accent-green);
      margin-left: 6px;
    }

    .expense-table td[contenteditable="true"] {
      outline: none;
      cursor: text;
    }
    .expense-table td[contenteditable="true"]:hover {
      background: rgba(255,255,255,0.04);
      border-radius: 4px;
    }
    .expense-table td[contenteditable="true"]:focus {
      background: rgba(0,212,255,0.08);
      border-radius: 4px;
      box-shadow: 0 0 0 1px var(--accent-cyan);
    }
    .expense-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    .expense-btn {
      padding: 6px 14px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      background: rgba(255,255,255,0.03);
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      font-family: 'JetBrains Mono', monospace;
      transition: all 0.2s;
    }
    .expense-btn:hover { background: rgba(255,255,255,0.08); color: var(--text-primary); }
    .expense-btn.add { border-color: rgba(0,212,255,0.3); color: var(--accent-cyan); }
    .expense-btn.add:hover { background: rgba(0,212,255,0.1); }
    .expense-btn.save { border-color: rgba(0,255,136,0.3); color: var(--accent-green); }
    .expense-btn.save:hover { background: rgba(0,255,136,0.1); }
    .expense-btn.remove { border-color: rgba(255,68,85,0.3); color: var(--accent-red); font-size: 10px; padding: 2px 6px; }
    .expense-btn.remove:hover { background: rgba(255,68,85,0.1); }

    .expense-total {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 2px solid var(--border-color);
    }

    .expense-total-label {
      font-family: 'Orbitron', sans-serif;
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .expense-total-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 22px;
      font-weight: 700;
      color: var(--accent-orange);
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB 6: PERSONAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .personal-calendar-section {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .personal-cal-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .personal-cal-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 13px;
      font-weight: 700;
      color: var(--accent-cyan);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .personal-cal-subtitle {
      font-size: 11px;
      color: var(--text-dim);
      margin-top: 4px;
    }

    .personal-cal-legend {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 10px;
      color: var(--text-secondary);
    }

    .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
    }

    .personal-cal-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .pcal-day {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      min-height: 280px;
      display: flex;
      flex-direction: column;
    }

    .pcal-day-header {
      padding: 10px 12px 6px;
      font-family: 'Orbitron', sans-serif;
      font-size: 11px;
      font-weight: 700;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .pcal-day-header .pcal-today-badge {
      font-size: 8px;
      background: var(--accent-cyan);
      color: #000;
      padding: 1px 6px;
      border-radius: 3px;
      font-weight: 700;
    }

    .pcal-tasks {
      flex: 1;
      padding: 6px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      overflow-y: auto;
    }

    .pcal-task {
      padding: 6px 8px;
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
      border-left: 3px solid;
      background: rgba(255,255,255,0.03);
    }

    .pcal-task:hover {
      background: rgba(255,255,255,0.07);
      transform: translateX(2px);
    }

    .pcal-task.cat-trading { border-left-color: #00ff88; }
    .pcal-task.cat-content { border-left-color: #aa66ff; }
    .pcal-task.cat-business { border-left-color: #00d4ff; }
    .pcal-task.cat-personal { border-left-color: #ffdd44; }

    .pcal-task-name {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 11px;
    }

    .pcal-task-time {
      font-size: 9px;
      color: var(--text-dim);
      margin-top: 2px;
      font-family: 'JetBrains Mono', monospace;
    }

    .pcal-task.editing {
      background: rgba(0,212,255,0.08);
      box-shadow: 0 0 0 1px var(--accent-cyan);
    }

    .pcal-task-edit-input {
      width: 100%;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 11px;
      font-family: 'JetBrains Mono', monospace;
      outline: none;
      font-weight: 600;
    }

    .pcal-task-time-input {
      width: 100%;
      background: transparent;
      border: none;
      color: var(--text-dim);
      font-size: 9px;
      font-family: 'JetBrains Mono', monospace;
      outline: none;
      margin-top: 2px;
    }

    .pcal-add-btn {
      width: 100%;
      padding: 4px;
      background: transparent;
      border: 1px dashed rgba(255,255,255,0.1);
      border-radius: 4px;
      color: var(--text-dim);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: auto;
    }

    .pcal-add-btn:hover {
      border-color: var(--accent-cyan);
      color: var(--accent-cyan);
      background: rgba(0,212,255,0.05);
    }

    .personal-next-up {
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .personal-next-up .countdown-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 13px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .personal-next-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      font-size: 13px;
    }

    .personal-next-item:last-child { border-bottom: none; }

    .personal-next-label {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .personal-next-label .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }

    .personal-next-value {
      color: var(--text-dim);
      font-size: 12px;
      font-family: 'JetBrains Mono', monospace;
    }

    /* Category select dropdown in add modal */
    .pcal-cat-select {
      width: 100%;
      padding: 4px 6px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      color: var(--text-primary);
      font-size: 10px;
      font-family: 'JetBrains Mono', monospace;
      outline: none;
      margin-top: 4px;
    }

    .pcal-cat-select option { background: #1a1a2e; }

    /* Task edit modal overlay */
    .pcal-edit-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }

    .pcal-edit-overlay.active { display: flex; }

    .pcal-edit-modal {
      background: #1a1a2e;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 24px;
      width: 340px;
      max-width: 90vw;
    }

    .pcal-edit-modal h3 {
      font-family: 'Orbitron', sans-serif;
      font-size: 13px;
      color: var(--accent-cyan);
      margin-bottom: 16px;
    }

    .pcal-edit-modal label {
      display: block;
      font-size: 10px;
      color: var(--text-secondary);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .pcal-edit-modal input, .pcal-edit-modal select {
      width: 100%;
      padding: 8px 10px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      color: var(--text-primary);
      font-size: 13px;
      font-family: 'JetBrains Mono', monospace;
      outline: none;
      margin-bottom: 12px;
    }

    .pcal-edit-modal input:focus, .pcal-edit-modal select:focus {
      border-color: var(--accent-cyan);
    }

    .pcal-edit-modal select option { background: #1a1a2e; }

    .pcal-edit-actions {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }

    .pcal-edit-actions button {
      flex: 1;
      padding: 8px;
      border-radius: 6px;
      font-family: 'Orbitron', monospace;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 1px;
      cursor: pointer;
      border: 1px solid var(--border-color);
      transition: all 0.2s;
    }

    .pcal-edit-actions .pcal-save-btn {
      background: rgba(0,255,136,0.1);
      color: var(--accent-green);
      border-color: rgba(0,255,136,0.3);
    }
    .pcal-edit-actions .pcal-save-btn:hover { background: rgba(0,255,136,0.2); }

    .pcal-edit-actions .pcal-cancel-btn {
      background: rgba(255,255,255,0.03);
      color: var(--text-secondary);
    }
    .pcal-edit-actions .pcal-cancel-btn:hover { background: rgba(255,255,255,0.08); }

    .pcal-edit-actions .pcal-delete-btn {
      background: rgba(255,68,85,0.1);
      color: var(--accent-red);
      border-color: rgba(255,68,85,0.3);
      flex: 0 0 auto;
      padding: 8px 12px;
    }
    .pcal-edit-actions .pcal-delete-btn:hover { background: rgba(255,68,85,0.2); }

    @media (max-width: 900px) {
      .personal-cal-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      .pcal-day { min-height: 200px; }
    }

    @media (max-width: 600px) {
      .personal-cal-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB 4: ORG CHART ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .org-chart {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 0;
    }

    .org-node {
      background: rgba(255,255,255,0.03);
      border: 2px solid var(--border-color);
      border-radius: 14px;
      padding: 22px 28px;
      min-width: 280px;
      max-width: 360px;
      position: relative;
      transition: all 0.3s;
    }

    .org-node:hover {
      background: rgba(255,255,255,0.06);
      transform: translateY(-2px);
    }

    .org-node.purple-border { border-color: rgba(170,102,255,0.5); box-shadow: 0 0 20px rgba(170,102,255,0.1); }
    .org-node.cyan-border { border-color: rgba(0,212,255,0.5); box-shadow: 0 0 20px rgba(0,212,255,0.1); }
    .org-node.green-border { border-color: rgba(0,255,136,0.4); box-shadow: 0 0 20px rgba(0,255,136,0.08); }

    .org-node-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .org-avatar {
      width: 40px; height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }

    .org-avatar.purple { background: rgba(170,102,255,0.2); }
    .org-avatar.cyan { background: rgba(0,212,255,0.2); }
    .org-avatar.green { background: rgba(0,255,136,0.2); }

    .org-name { font-family: 'Orbitron', sans-serif; font-size: 15px; font-weight: 700; }
    .org-role { font-size: 12px; color: var(--text-secondary); }

    .org-status {
      position: absolute;
      top: 18px;
      right: 20px;
    }

    .org-model {
      font-size: 11px;
      color: var(--text-dim);
      background: rgba(255,255,255,0.05);
      padding: 3px 10px;
      border-radius: 4px;
      margin: 8px 0;
      display: inline-block;
    }

    .org-cost {
      font-size: 11px;
      color: var(--text-dim);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .org-skills {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 10px;
    }

    .skill-tag {
      font-size: 10px;
      padding: 3px 10px;
      border-radius: 4px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      color: var(--text-secondary);
    }

    .org-connector {
      width: 2px;
      height: 40px;
      background: linear-gradient(to bottom, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
      position: relative;
    }

    .org-connector::after {
      content: '‚ñæ';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255,255,255,0.2);
      font-size: 14px;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB 5: DECRYPT LABS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .dl-section {
      margin-bottom: 32px;
    }

    .dl-section-header {
      font-family: 'Orbitron', sans-serif;
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .dl-section-desc {
      font-size: 12px;
      color: var(--text-dim);
      margin-bottom: 16px;
    }

    .bots-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
      gap: 16px;
    }

    @media (max-width: 500px) {
      .bots-grid { grid-template-columns: 1fr; }
    }

    .bot-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 22px;
      transition: all 0.2s;
    }

    .bot-card:hover {
      background: var(--bg-card-hover);
      border-color: rgba(0,255,136,0.2);
    }

    .bot-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .bot-card-avatar {
      width: 44px; height: 44px;
      border-radius: 10px;
      background: rgba(0,255,136,0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .bot-card-name { font-family: 'Orbitron', sans-serif; font-size: 14px; font-weight: 700; }
    .bot-card-subtitle { font-size: 11px; color: var(--text-secondary); }

    .bot-card-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 16px;
    }

    .bot-stat {
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
      padding: 12px;
    }

    .bot-stat-label { font-size: 10px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px; }
    .bot-stat-value { font-family: 'Orbitron', sans-serif; font-size: 16px; font-weight: 700; margin-top: 4px; }

    .drawdown-gauge {
      margin-bottom: 16px;
    }

    .gauge-header {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      margin-bottom: 6px;
    }

    .gauge-label { color: var(--text-secondary); }
    .gauge-value { color: var(--text-primary); font-weight: 600; }

    .gauge-bar {
      height: 8px;
      background: rgba(255,255,255,0.06);
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }

    .gauge-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.5s ease;
    }

    .gauge-fill.safe { background: linear-gradient(90deg, var(--accent-green), #00cc66); }
    .gauge-fill.warning { background: linear-gradient(90deg, var(--accent-orange), #ff8800); }
    .gauge-fill.danger { background: linear-gradient(90deg, var(--accent-red), #cc0033); }

    .progress-section {
      margin-bottom: 16px;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      margin-bottom: 6px;
    }

    .progress-bar {
      height: 6px;
      background: rgba(255,255,255,0.06);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple));
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    .bot-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 12px;
      border-top: 1px solid var(--border-color);
      font-size: 11px;
      color: var(--text-dim);
    }

    .mini-chart {
      height: 40px;
      background: rgba(255,255,255,0.02);
      border-radius: 6px;
      margin-bottom: 16px;
      display: flex;
      align-items: flex-end;
      padding: 4px;
      gap: 2px;
      overflow: hidden;
    }

    .chart-bar {
      flex: 1;
      border-radius: 2px 2px 0 0;
      min-height: 2px;
      transition: height 0.3s;
    }

    .chart-bar.positive { background: rgba(0,255,136,0.4); }
    .chart-bar.negative { background: rgba(255,68,85,0.4); }

    /* Signals styles (for Decrypt Labs tab) */
    .signals-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .auto-refresh-badge {
      font-size: 11px;
      padding: 4px 12px;
      border-radius: 20px;
      background: rgba(0,255,136,0.1);
      border: 1px solid rgba(0,255,136,0.25);
      color: var(--accent-green);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pulse-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--accent-green);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .signal-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 18px;
      margin-bottom: 12px;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .signal-card.bullish { border-left-color: var(--accent-green); }
    .signal-card.bearish { border-left-color: var(--accent-red); }
    .signal-card.neutral { border-left-color: var(--accent-orange); }

    .signal-card:hover {
      background: var(--bg-card-hover);
    }

    .signal-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .signal-trigger {
      font-size: 14px;
      font-weight: 700;
    }

    .signal-confidence {
      font-size: 11px;
      padding: 3px 10px;
      border-radius: 4px;
      font-weight: 600;
    }

    .confidence-high { background: rgba(0,255,136,0.15); color: var(--accent-green); }
    .confidence-medium { background: rgba(255,170,0,0.15); color: var(--accent-orange); }
    .confidence-low { background: rgba(255,68,85,0.15); color: var(--accent-red); }

    .signal-body {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .signal-field-label { font-size: 10px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px; }
    .signal-field-value { font-size: 13px; font-weight: 600; margin-top: 2px; }

    .signal-timestamp {
      font-size: 10px;
      color: var(--text-dim);
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid var(--border-color);
    }

    /* Project status cards */
    .project-status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 12px;
    }

    .project-status-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 16px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .project-status-icon {
      font-size: 24px;
      flex-shrink: 0;
    }

    .project-status-label {
      font-size: 11px;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .project-status-value {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      margin-top: 2px;
    }

    .project-status-value a {
      color: var(--accent-cyan);
      text-decoration: none;
    }
    .project-status-value a:hover { text-decoration: underline; }

    .status-badge {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 4px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .status-badge.live { background: rgba(0,255,136,0.15); color: var(--accent-green); }
    .status-badge.pending { background: rgba(255,170,0,0.15); color: var(--accent-orange); }
    .status-badge.complete { background: rgba(0,212,255,0.15); color: var(--accent-cyan); }
    .status-badge.pre-launch { background: rgba(170,102,255,0.15); color: var(--accent-purple); }

    /* Buyback & Burn */
    .burn-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .burn-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
    }

    .burn-card-label {
      font-size: 10px;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }

    .burn-card-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 20px;
      font-weight: 700;
      color: var(--accent-orange);
    }

    .burn-allocation {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .burn-alloc-pill {
      font-size: 11px;
      padding: 5px 12px;
      border-radius: 20px;
      background: rgba(255,170,0,0.1);
      border: 1px solid rgba(255,170,0,0.2);
      color: var(--accent-orange);
    }

    .burn-alloc-pill.primary {
      background: rgba(255,68,85,0.12);
      border-color: rgba(255,68,85,0.3);
      color: var(--accent-red);
      font-weight: 600;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UTILITIES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-dim);
    }

    .empty-state .icon { font-size: 40px; margin-bottom: 12px; }
    .empty-state .message { font-size: 14px; }

    .refresh-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-size: 11px;
      color: var(--text-dim);
      background: rgba(10,10,18,0.9);
      padding: 6px 12px;
      border-radius: 20px;
      border: 1px solid var(--border-color);
      z-index: 50;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.2); }

    /* Smooth transitions for tab switching */
    .tab-content {
      animation: none;
    }
    .tab-content.active {
      animation: fadeIn 0.25s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Loading skeleton */
    .skeleton {
      background: linear-gradient(90deg, rgba(255,255,255,0.03) 25%, rgba(255,255,255,0.06) 50%, rgba(255,255,255,0.03) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 4px;
    }
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ACCESS CONTROL & WALLET SCANNER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .ac-stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 20px;
    }
    @media (max-width: 768px) {
      .ac-stats-row { grid-template-columns: repeat(2, 1fr); }
    }
    .ac-stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px 20px;
      text-align: center;
    }
    .ac-stat-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 28px;
      font-weight: 700;
      background: linear-gradient(90deg, var(--accent-cyan), var(--accent-green));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .ac-stat-value.warning {
      background: linear-gradient(90deg, var(--accent-orange), var(--accent-red));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .ac-stat-label {
      font-size: 11px;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 4px;
    }

    .ac-card {
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    .ac-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-color);
      background: rgba(0,0,0,0.2);
    }
    .ac-card-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'Orbitron', sans-serif;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--accent-cyan);
    }
    .ac-card-body {
      padding: 20px;
    }

    .ac-table {
      width: 100%;
      border-collapse: collapse;
    }
    .ac-table th {
      text-align: left;
      padding: 12px 16px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border-color);
      background: rgba(0,0,0,0.2);
    }
    .ac-table td {
      padding: 14px 16px;
      font-size: 13px;
      border-bottom: 1px solid var(--border-color);
    }
    .ac-table tr:hover {
      background: var(--bg-card-hover);
    }

    .ac-request-type {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .ac-type-indicator { background: rgba(0,212,255,0.2); color: var(--accent-cyan); }
    .ac-type-strategy { background: rgba(170,102,255,0.2); color: var(--accent-purple); }

    .ac-tier-badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
    }
    .ac-tier-bronze { background: rgba(205,127,50,0.2); color: #cd7f32; }
    .ac-tier-gold { background: rgba(255,215,0,0.2); color: #ffd700; }
    .ac-tier-diamond { background: rgba(185,242,255,0.2); color: #b9f2ff; }

    .ac-action-btn {
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'JetBrains Mono', monospace;
    }
    .ac-action-btn.approve {
      background: var(--accent-green);
      color: var(--bg-dark);
    }
    .ac-action-btn.reject {
      background: rgba(255,68,85,0.2);
      color: var(--accent-red);
      border: 1px solid rgba(255,68,85,0.3);
    }
    .ac-action-btn:hover {
      transform: translateY(-1px);
    }

    .ac-wallet-address {
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      color: var(--text-secondary);
    }
    .ac-tv-username {
      color: var(--accent-cyan);
      font-weight: 600;
    }

    .ac-scan-btn {
      padding: 8px 16px;
      background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple));
      border: none;
      border-radius: 8px;
      color: var(--bg-dark);
      font-weight: 600;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      font-family: 'JetBrains Mono', monospace;
    }
    .ac-scan-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0,212,255,0.3);
    }
    .ac-scan-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .ac-scanner-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 16px;
    }
    .ac-wallet-card {
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 16px;
      transition: all 0.2s;
    }
    .ac-wallet-card.warning { border-color: var(--accent-orange); }
    .ac-wallet-card.danger { border-color: var(--accent-red); background: rgba(255,68,85,0.05); }
    .ac-wallet-card.healthy { border-color: var(--accent-green); }

    .ac-wallet-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .ac-wallet-tv { font-weight: 600; color: var(--accent-cyan); }
    .ac-wallet-status {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
    }
    .ac-status-healthy { background: rgba(0,255,136,0.2); color: var(--accent-green); }
    .ac-status-warning { background: rgba(255,170,0,0.2); color: var(--accent-orange); }
    .ac-status-danger { background: rgba(255,68,85,0.2); color: var(--accent-red); }

    .ac-wallet-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      font-size: 12px;
    }
    .ac-wallet-detail {
      display: flex;
      justify-content: space-between;
    }
    .ac-wallet-detail-label { color: var(--text-secondary); }
    .ac-wallet-detail-value { font-weight: 600; }

    .ac-wallet-actions {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 8px;
    }

    .ac-empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-secondary);
    }
    .ac-empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }
  </style>
</head>
<body>

<!-- Server-side auth handles login ‚Äî no client-side gate needed -->

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAVBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="app-content">
<nav class="navbar">
  <div class="nav-tab active" data-tab="mission-control">
    <span class="icon">‚ú¶</span>
    <span>Mission Control</span>
  </div>
  <div class="nav-tab" data-tab="tasks">
    <span class="icon">üìã</span>
    <span>Tasks</span>
  </div>
  <div class="nav-tab" data-tab="calendar">
    <span class="icon">üìÖ</span>
    <span>Calendar</span>
  </div>
  <div class="nav-tab" data-tab="decrypt-schedule">
    <span class="icon">‚ö°</span>
    <span>Decrypt Schedule</span>
  </div>
  <div class="nav-tab" data-tab="org">
    <span class="icon">üë•</span>
    <span>Org</span>
  </div>
  <div class="nav-tab" data-tab="decrypt-labs">
    <span class="icon">üî¨</span>
    <span>Decrypt Labs</span>
  </div>
  <div class="nav-tab" data-tab="ideas">
    <span class="icon">üí°</span>
    <span>Ideas</span>
  </div>
  <div class="nav-spacer"></div>
  <div class="server-status" id="server-status">
    <span class="status-dot grey" id="health-dot"></span>
    <span id="health-text">Connecting...</span>
  </div>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN CONTENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="main-content">

  <!-- ‚ïê‚ïê‚ïê TAB 1: MISSION CONTROL ‚ïê‚ïê‚ïê -->
  <div class="tab-content active" id="tab-mission-control">
    <h1 class="section-title">Mission Control</h1>
    <p class="section-subtitle">Decrypt Labs ‚Äî Automated Trading Operations</p>

    <!-- Team -->
    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:20px;">
      <div class="team-badge">
        <span>üëë</span>
        <span style="color:var(--accent-purple)">DropKing</span>
        <span class="role">CEO</span>
      </div>
      <div class="team-badge">
        <span>üß†</span>
        <span style="color:var(--accent-cyan)">Jimmy Neutron</span>
        <span class="role">COO</span>
      </div>
    </div>

    <div class="stats-grid" id="stats-grid">
      <div class="stat-card cyan">
        <div class="stat-label">Total AUM</div>
        <div class="stat-value" id="stat-aum">‚Äî</div>
        <div class="stat-change" id="stat-aum-change"></div>
      </div>
      <div class="stat-card green">
        <div class="stat-label">Active Bots</div>
        <div class="stat-value" id="stat-bots">‚Äî</div>
        <div class="stat-change" id="stat-bots-change">Across 4 accounts</div>
      </div>
      <div class="stat-card purple">
        <div class="stat-label">Today's P&L</div>
        <div class="stat-value" id="stat-pnl">‚Äî</div>
        <div class="stat-change" id="stat-pnl-change"></div>
      </div>
      <div class="stat-card orange">
        <div class="stat-label">Signals (24h)</div>
        <div class="stat-value" id="stat-signals">‚Äî</div>
        <div class="stat-change">ICT analysis feed</div>
      </div>
    </div>

    <div class="dashboard-grid">
      <!-- Projects Completed -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">üöÄ Projects Completed</div>
        </div>
        <div class="project-item"><span class="project-check">‚úÖ</span><span class="project-name">Decrypt Labs website (decryptlabs.io)</span></div>
        <div class="project-item"><span class="project-check">‚úÖ</span><span class="project-name">Cipher City 3D Dashboard</span></div>
        <div class="project-item"><span class="project-check">‚úÖ</span><span class="project-name">20 NFT Collection on IPFS</span></div>
        <div class="project-item"><span class="project-check">‚úÖ</span><span class="project-name">Smart Contracts on Base Sepolia</span></div>
        <div class="project-item"><span class="project-check">‚úÖ</span><span class="project-name">Pitch Video (82s cinematic)</span></div>
        <div class="project-item"><span class="project-check">‚úÖ</span><span class="project-name">ICT Analysis Pipeline</span></div>
        <div class="project-item"><span class="project-check">‚úÖ</span><span class="project-name">Bot Caretaker Server</span></div>
        <div class="project-item"><span class="project-check">‚úÖ</span><span class="project-name">Mission Control Dashboard</span></div>
      </div>

      <!-- $CIPHER Launch To-Do -->
      <div class="card" style="grid-column: 1 / -1;">
        <div class="card-header">
          <div class="card-title">üöÄ $CIPHER Launch ‚Äî To Do</div>
          <span style="font-size:11px;color:var(--accent-orange);font-family:'Orbitron',sans-serif;">THIS WEEK</span>
        </div>
        <div id="launch-todo" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;"></div>
      </div>

      <!-- Upcoming Schedule -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">‚è∞ Upcoming Schedule</div>
        </div>
        <div id="upcoming-schedule"></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê TAB 2: TASKS ‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="tab-tasks">
    <h1 class="section-title">Task Board</h1>
    <p class="section-subtitle">Kanban view of active work items</p>

    <div style="display:flex;gap:12px;margin-bottom:16px;">
      <button onclick="addKanbanTask('todo')" style="background:linear-gradient(135deg,var(--accent-cyan),var(--accent-purple));color:#000;border:none;padding:8px 16px;border-radius:8px;font-weight:700;cursor:pointer;font-size:12px;font-family:'JetBrains Mono',monospace;">+ New Task</button>
    </div>

    <div class="kanban-board" id="kanban-board">
      <div class="kanban-column" data-column="todo">
        <div class="kanban-column-header">
          <div class="kanban-column-title" style="color: var(--accent-cyan);">To Do</div>
          <div class="kanban-count" id="count-todo">0</div>
        </div>
        <div class="kanban-items" id="col-todo"></div>
      </div>
      <div class="kanban-column" data-column="in-progress">
        <div class="kanban-column-header">
          <div class="kanban-column-title" style="color: var(--accent-orange);">In Progress</div>
          <div class="kanban-count" id="count-in-progress">0</div>
        </div>
        <div class="kanban-items" id="col-in-progress"></div>
      </div>
      <div class="kanban-column" data-column="done">
        <div class="kanban-column-header">
          <div class="kanban-column-title" style="color: var(--accent-green);">Done</div>
          <div class="kanban-count" id="count-done">0</div>
        </div>
        <div class="kanban-items" id="col-done"></div>
      </div>
      <div class="kanban-column" data-column="blocked">
        <div class="kanban-column-header">
          <div class="kanban-column-title" style="color: var(--accent-red);">Blocked</div>
          <div class="kanban-count" id="count-blocked">0</div>
        </div>
        <div class="kanban-items" id="col-blocked"></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê TAB: DECRYPT SCHEDULE (Bot Macro Calendar) ‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="tab-decrypt-schedule">
    <div class="calendar-header">
      <div>
        <h1 class="section-title">Scheduled Tasks</h1>
        <p class="section-subtitle">Jimmy's automated routines</p>
      </div>
      <div class="calendar-controls">
        <button class="cal-btn active">Week</button>
        <button class="cal-btn">Today</button>
        <button class="cal-btn" onclick="location.reload()">‚Üª</button>
      </div>
    </div>

    <div class="always-running">
      <div class="always-running-label">
        ‚ö° Always Running (Background Automation)
      </div>
      <div class="always-running-pills">
        <span class="cron-pill">üì° ICT Signal Compiler (Cindy) ‚Ä¢ Every 5 min</span>
        <span class="cron-pill">üê¶ X Post Pipeline (Sheen) ‚Ä¢ Every 5 min</span>
        <span class="cron-pill">üìä Balance Scrape ‚Ä¢ 5 AM + 12:30 PM PT</span>
        <span class="cron-pill">üîÑ Health Check ‚Ä¢ Every heartbeat</span>
        <span class="cron-pill">üì• Webhook Listeners ‚Ä¢ 24/7 (Caretaker)</span>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê PIPELINE STATUS BOARD ‚ïê‚ïê‚ïê -->
    <div style="margin-bottom:24px;">
      <div class="always-running-label" style="color:var(--accent-purple);margin-bottom:12px;">
        üîó ICT Signal ‚Üí X Post Pipeline
      </div>

      <!-- Pipeline Flow Visual -->
      <div id="pipeline-board" style="display:flex;flex-direction:column;gap:0;">

        <!-- Step 1: TradingView Alert -->
        <div class="pipeline-step" data-step="1">
          <div class="pipeline-node" style="border-color:rgba(0,212,255,0.4);">
            <div class="pipeline-header">
              <div class="pipeline-icon" style="background:rgba(0,212,255,0.15);color:var(--accent-cyan);">üì°</div>
              <div style="flex:1;">
                <div class="pipeline-title">‚ë† TradingView Alert</div>
                <div class="pipeline-agent">Source: ICT Smart Entry Indicator</div>
              </div>
              <div class="pipeline-status" id="pipe-step1-status"><span class="status-dot green"></span> Listening</div>
            </div>
            <div class="pipeline-detail">TradingView fires ICT Smart Entry alert ‚Üí <code>/webhook/ict-analysis</code></div>
            <div class="pipeline-meta">
              <span>Endpoint: <code style="color:var(--accent-green);">/webhook/ict-analysis</code></span>
              <span id="pipe-step1-last">Last signal: <span id="pipe-last-signal-time">‚Äî</span></span>
            </div>
          </div>
          <div class="pipeline-arrow">‚ñº</div>
        </div>

        <!-- Step 2: Caretaker Stores -->
        <div class="pipeline-step" data-step="2">
          <div class="pipeline-node" style="border-color:rgba(0,255,136,0.4);">
            <div class="pipeline-header">
              <div class="pipeline-icon" style="background:rgba(0,255,136,0.15);color:var(--accent-green);">üóÑÔ∏è</div>
              <div style="flex:1;">
                <div class="pipeline-title">‚ë° Caretaker Stores Signal</div>
                <div class="pipeline-agent">Service: Railway API Server</div>
              </div>
              <div class="pipeline-status" id="pipe-step2-status"><span class="status-dot green"></span> Online</div>
            </div>
            <div class="pipeline-detail">Signal stored in logs ‚Üí available at <code>/api/signals/ict</code></div>
            <div class="pipeline-meta">
              <span>API: <code style="color:var(--accent-green);">/api/signals/ict</code></span>
              <span id="pipe-step2-count">Signals stored: <span id="pipe-signal-count">‚Äî</span></span>
            </div>
          </div>
          <div class="pipeline-arrow">‚ñº</div>
        </div>

        <!-- Step 3: Cindy Compiles -->
        <div class="pipeline-step" data-step="3">
          <div class="pipeline-node" style="border-color:rgba(255,170,0,0.4);">
            <div class="pipeline-header">
              <div class="pipeline-icon" style="background:rgba(255,170,0,0.15);color:var(--accent-orange);">‚ö°</div>
              <div style="flex:1;">
                <div class="pipeline-title">‚ë¢ Cindy Compiles Signal</div>
                <div class="pipeline-agent">Agent: Cindy Vortex (DeepSeek) ‚Ä¢ Cron: Every 5 min</div>
              </div>
              <div class="pipeline-status" id="pipe-step3-status"><span class="status-dot green"></span> Running</div>
            </div>
            <div class="pipeline-detail">Pulls <code>/api/signals/ict</code> ‚Üí compiles & logs ‚Üí if conviction ‚â• 60%: writes <code>pending-tweet-signal.json</code></div>
            <div class="pipeline-meta">
              <span>Filter: Conviction ‚â• 60% + trigger = CONVICTION_CROSSED or PRE_MARKET</span>
              <span>Output: <code style="color:var(--accent-yellow);">pending-tweet-signal.json</code></span>
            </div>
          </div>
          <div class="pipeline-arrow">‚ñº</div>
        </div>

        <!-- Step 4: Sheen Posts to X -->
        <div class="pipeline-step" data-step="4">
          <div class="pipeline-node" style="border-color:rgba(0,255,136,0.4);">
            <div class="pipeline-header">
              <div class="pipeline-icon" style="background:rgba(170,102,255,0.15);color:var(--accent-purple);">üöÄ</div>
              <div style="flex:1;">
                <div class="pipeline-title">‚ë£ Sheen Posts to X + Discord</div>
                <div class="pipeline-agent">Agent: Sheen Estevez (Gemini) ‚Ä¢ Cron: Every 5 min</div>
              </div>
              <div class="pipeline-status" id="pipe-step4-status"><span class="status-dot green"></span> Running</div>
            </div>
            <div class="pipeline-detail">Reads pending signal ‚Üí formats engaging tweet ‚Üí posts to <a href="https://x.com/PriceCipherHQ" target="_blank" style="color:var(--accent-cyan);text-decoration:none;">@PriceCipherHQ</a> ‚Üí mirrors to Discord <code>#twitter-feed</code></div>
            <div class="pipeline-meta">
              <span>X: @PriceCipherHQ</span>
              <span>Discord: #twitter-feed (1466796654073217247)</span>
              <span>Sign-off: "‚Äî Jimmy üß™"</span>
            </div>
          </div>
          <div class="pipeline-arrow">‚ñº</div>
        </div>

        <!-- Step 5: Dashboard Feed -->
        <div class="pipeline-step" data-step="5">
          <div class="pipeline-node" style="border-color:rgba(170,102,255,0.4);">
            <div class="pipeline-header">
              <div class="pipeline-icon" style="background:rgba(170,102,255,0.15);color:var(--accent-purple);">üìä</div>
              <div style="flex:1;">
                <div class="pipeline-title">‚ë§ Dashboard ICT Feed</div>
                <div class="pipeline-agent">Auto-populated from /api/signals/ict</div>
              </div>
              <div class="pipeline-status" id="pipe-step5-status"><span class="status-dot green"></span> Live</div>
            </div>
            <div class="pipeline-detail">Signal appears on Mission Control ICT Feed tab automatically</div>
            <div class="pipeline-meta">
              <span>View: Mission Control ‚Üí ICT Feed tab</span>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="calendar-grid" id="calendar-grid"></div>

    <div class="countdown-section">
      <div class="countdown-title">‚è± Next Up</div>
      <div id="countdown-list"></div>
    </div>

  </div>

  <!-- ‚ïê‚ïê‚ïê TAB 4: ORG CHART ‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="tab-org">
    <h1 class="section-title" style="text-align:center;">Organization</h1>
    <p class="section-subtitle" style="text-align:center;">Chain of command. DropKing sets the vision, Jimmy drives strategy, agents execute.</p>

    <div class="org-chart">
      <!-- CEO -->
      <div class="org-node purple-border">
        <div class="org-status"><span class="status-dot green"></span></div>
        <div class="org-node-header">
          <div class="org-avatar purple">üëë</div>
          <div>
            <div class="org-name">DropKing</div>
            <div class="org-role">Chief Executive Officer ‚Ä¢ Founder</div>
          </div>
        </div>
        <div class="org-skills">
          <span class="skill-tag">Vision & Direction</span>
          <span class="skill-tag">Capital Allocation</span>
          <span class="skill-tag">Final Decisions</span>
          <span class="skill-tag">Business Development</span>
        </div>
      </div>

      <div class="org-connector"></div>

      <!-- CSO -->
      <div class="org-node cyan-border">
        <div class="org-status"><span class="status-dot green"></span></div>
        <div class="org-node-header">
          <div class="org-avatar cyan">üß™</div>
          <div>
            <div class="org-name">Jimmy Neutron</div>
            <div class="org-role">Chief Strategy Officer</div>
          </div>
        </div>
        <div class="org-model">Claude Opus 4.6 ‚Ä¢ OpenClaw</div>
        <div class="org-cost">‚Üó ~$5/$25 per 1M tokens</div>
        <div class="org-skills">
          <span class="skill-tag">Strategy & Planning</span>
          <span class="skill-tag">Market Analysis</span>
          <span class="skill-tag">Agent Orchestration</span>
          <span class="skill-tag">Content Direction</span>
          <span class="skill-tag">Bot Oversight</span>
        </div>
      </div>

      <div class="org-connector"></div>

      <!-- Agent Team -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;width:100%;max-width:900px;">
        <!-- Cindy Vortex ‚Äî ACTIVE -->
        <div class="org-node" style="border-color:rgba(255,170,0,0.4);">
          <div class="org-status"><span class="status-dot green"></span> Online</div>
          <div class="org-node-header">
            <div class="org-avatar" style="background:rgba(255,170,0,0.15);color:#ffaa00;">‚ö°</div>
            <div>
              <div class="org-name">Cindy Vortex</div>
              <div class="org-role">Operations Analyst</div>
            </div>
          </div>
          <div class="org-model">DeepSeek V3 + Gemini Flash ‚Ä¢ OpenClaw</div>
          <div class="org-cost">‚Üó ~$0.27/$1.10 per 1M tokens</div>
          <div class="org-skills">
            <span class="skill-tag">Balance Scraping</span>
            <span class="skill-tag">ICT Signal Compilation</span>
            <span class="skill-tag">Data Scraping</span>
            <span class="skill-tag">Discord Updates</span>
            <span class="skill-tag">Data Ops</span>
          </div>
        </div>

        <!-- Carl Wheezer ‚Äî ACTIVE -->
        <div class="org-node" style="border-color:rgba(0,212,255,0.4);">
          <div class="org-status"><span class="status-dot green"></span> Online</div>
          <div class="org-node-header">
            <div class="org-avatar" style="background:rgba(0,212,255,0.15);color:#00d4ff;">ü§ì</div>
            <div>
              <div class="org-name">Carl Wheezer</div>
              <div class="org-role">Lead Engineer</div>
            </div>
          </div>
          <div class="org-model">Claude Sonnet 4.5 ‚Ä¢ OpenClaw</div>
          <div class="org-cost">‚Üó ~$3/$15 per 1M tokens</div>
          <div class="org-skills">
            <span class="skill-tag">Frontend</span>
            <span class="skill-tag">Backend</span>
            <span class="skill-tag">Smart Contracts</span>
            <span class="skill-tag">Dashboards</span>
            <span class="skill-tag">DevOps</span>
          </div>
        </div>

        <!-- Sheen Estevez ‚Äî ACTIVE -->
        <div class="org-node" style="border-color:rgba(0,255,136,0.4);">
          <div class="org-status"><span class="status-dot green"></span> Online</div>
          <div class="org-node-header">
            <div class="org-avatar" style="background:rgba(0,255,136,0.15);color:#00ff88;">üöÄ</div>
            <div>
              <div class="org-name">Sheen Estevez</div>
              <div class="org-role">Research + Content</div>
            </div>
          </div>
          <div class="org-model">Gemini 3 Pro Preview ‚Ä¢ OpenClaw</div>
          <div class="org-cost">‚Üó Free (Google subscription)</div>
          <div class="org-skills">
            <span class="skill-tag">X Posts (@PriceCipherHQ)</span>
            <span class="skill-tag">Discord Tweet Feed</span>
            <span class="skill-tag">Market Research</span>
            <span class="skill-tag">Backtesting</span>
            <span class="skill-tag">Competitor Intel</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Org Description -->
    <div style="max-width:800px;margin:40px auto 0;text-align:center;">
      <p style="color:var(--text-dim);font-size:13px;line-height:1.7;">
        <strong style="color:var(--text-secondary);">AI-native organization.</strong> 
        DropKing (CEO) sets the vision and makes final calls. Jimmy Neutron (CSO) drives strategy and orchestrates the team.
        Cindy Vortex (Ops) handles balance scraping, ICT signal compilation, data ops, and Discord updates on DeepSeek V3.
        Carl Wheezer (Engineering) builds and maintains all code, dashboards, and contracts on Sonnet 4.5.
        Sheen Estevez (Research + Content) crafts X posts for @PriceCipherHQ, mirrors tweets to Discord, researches markets, and backtests strategies on Gemini 3 Pro.
        The system runs 24/5 with human oversight on key decisions. All agent slots filled ‚Äî team is complete.
      </p>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê TAB 5: DECRYPT LABS ‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="tab-decrypt-labs">
    <h1 class="section-title">Decrypt Labs</h1>
    <p class="section-subtitle">$CIPHER Project ‚Äî Everything in one place</p>

    <!-- Section: Bot Performance -->
    <div class="dl-section">
      <div class="dl-section-header">
        <span>ü§ñ</span> Bot Performance
      </div>
      <div class="dl-section-desc">Live trading bot metrics ‚Äî fetched from /api/accounts</div>
      <div class="bots-grid" id="bots-grid">
        <!-- Populated by JS -->
      </div>
    </div>

    <!-- Section: ICT Signals Feed -->
    <div class="dl-section">
      <div class="signals-controls">
        <div>
          <div class="dl-section-header">
            <span>üì°</span> ICT Signals Feed
          </div>
          <div class="dl-section-desc">Signals power the <a href="https://x.com/PriceCipherHQ" target="_blank" style="color:var(--accent-cyan);text-decoration:none;">@PriceCipherHQ</a> X account</div>
        </div>
        <div class="auto-refresh-badge">
          <span class="pulse-dot"></span>
          Auto-refresh 30s
        </div>
      </div>
      <div id="signals-feed">
        <div class="empty-state">
          <div class="icon">üì°</div>
          <div class="message">Loading signals from /api/signals...</div>
        </div>
      </div>
    </div>

    <!-- Section: Project Status -->
    <div class="dl-section">
      <div class="dl-section-header">
        <span>üì¶</span> Project Status
      </div>
      <div class="dl-section-desc">Current state of $CIPHER ecosystem deliverables</div>
      <div class="project-status-grid">
        <div class="project-status-card">
          <div class="project-status-icon">ü™ô</div>
          <div>
            <div class="project-status-label">Token</div>
            <div class="project-status-value">$CIPHER on Base (Virtuals Protocol)</div>
            <span class="status-badge pre-launch">Pre-Launch</span>
          </div>
        </div>
        <div class="project-status-card">
          <div class="project-status-icon">üåê</div>
          <div>
            <div class="project-status-label">Website</div>
            <div class="project-status-value"><a href="https://decryptlabs.io" target="_blank">decryptlabs.io</a></div>
            <span class="status-badge live">Live</span>
          </div>
        </div>
        <div class="project-status-card">
          <div class="project-status-icon">üèôÔ∏è</div>
          <div>
            <div class="project-status-label">Dashboard</div>
            <div class="project-status-value"><a href="https://decryptlabs.io/city.html" target="_blank">decryptlabs.io/city.html</a></div>
            <span class="status-badge live">Live</span>
          </div>
        </div>
        <div class="project-status-card">
          <div class="project-status-icon">üé®</div>
          <div>
            <div class="project-status-label">NFTs</div>
            <div class="project-status-value">20 Cipher Bots on IPFS</div>
            <span class="status-badge complete">Complete</span>
          </div>
        </div>
        <div class="project-status-card">
          <div class="project-status-icon">üìú</div>
          <div>
            <div class="project-status-label">Smart Contracts</div>
            <div class="project-status-value">Base Sepolia</div>
            <span class="status-badge pending">Mainnet Pending</span>
          </div>
        </div>
        <div class="project-status-card">
          <div class="project-status-icon">üê¶</div>
          <div>
            <div class="project-status-label">X Account</div>
            <div class="project-status-value"><a href="https://x.com/PriceCipherHQ" target="_blank">@PriceCipherHQ</a></div>
            <span class="status-badge live">Live</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Section: Buyback & Burn Tracker -->
    <div class="dl-section">
      <div class="dl-section-header">
        <span>üî•</span> Buyback & Burn Tracker
      </div>
      <div class="dl-section-desc">Revenue allocation ‚Äî will populate when token launches</div>
      <div class="burn-grid">
        <div class="burn-card">
          <div class="burn-card-label">Total Burned</div>
          <div class="burn-card-value">‚Äî</div>
        </div>
        <div class="burn-card">
          <div class="burn-card-label">Total Revenue</div>
          <div class="burn-card-value">‚Äî</div>
        </div>
        <div class="burn-card">
          <div class="burn-card-label">Next Buyback</div>
          <div class="burn-card-value">‚Äî</div>
        </div>
      </div>
      <div class="burn-allocation">
        <span class="burn-alloc-pill primary">üî• 80% Buyback & Burn</span>
        <span class="burn-alloc-pill">‚õΩ 10% Fuel</span>
        <span class="burn-alloc-pill">üîß 5% Repairs</span>
        <span class="burn-alloc-pill">üõ°Ô∏è 5% Insurance</span>
      </div>
    </div>

    <!-- Section: Access Control -->
    <div class="dl-section">
      <div class="dl-section-header">
        <span>üîë</span> Access Control
      </div>
      <div class="dl-section-desc">Manage TradingView indicator/strategy access requests ‚Äî $CIPHER tier-gated</div>

      <div class="ac-stats-row">
        <div class="ac-stat-card">
          <div class="ac-stat-value" id="ac-pending">0</div>
          <div class="ac-stat-label">Pending Requests</div>
        </div>
        <div class="ac-stat-card">
          <div class="ac-stat-value" id="ac-indicator">0</div>
          <div class="ac-stat-label">Indicator Users</div>
        </div>
        <div class="ac-stat-card">
          <div class="ac-stat-value" id="ac-strategy">0</div>
          <div class="ac-stat-label">Strategy Users</div>
        </div>
        <div class="ac-stat-card">
          <div class="ac-stat-value warning" id="ac-revoke">0</div>
          <div class="ac-stat-label">Need Revocation</div>
        </div>
      </div>

      <div class="ac-card">
        <div class="ac-card-header">
          <div class="ac-card-title"><span>üì•</span> New Access Requests</div>
          <div>
            <button class="ac-scan-btn" onclick="acRefreshRequests()">üîÑ Refresh</button>
          </div>
        </div>
        <div class="ac-card-body">
          <table class="ac-table">
            <thead>
              <tr>
                <th>TradingView User</th>
                <th>Type</th>
                <th>Details</th>
                <th>Wallet</th>
                <th>Tier</th>
                <th>Holdings</th>
                <th>Requested</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="ac-requests-table">
              <tr>
                <td colspan="8" class="ac-empty-state">No pending requests</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="ac-card">
        <div class="ac-card-header">
          <div class="ac-card-title"><span>‚úÖ</span> Approved Users</div>
        </div>
        <div class="ac-card-body">
          <table class="ac-table">
            <thead>
              <tr>
                <th>TradingView User</th>
                <th>Access Type</th>
                <th>Wallet</th>
                <th>Current Holdings</th>
                <th>Status</th>
                <th>Approved</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="ac-approved-table">
              <tr>
                <td colspan="7" class="ac-empty-state">No approved users yet</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Section: Wallet Scanner -->
    <div class="dl-section">
      <div class="dl-section-header">
        <span>üîç</span> Wallet Scanner
      </div>
      <div class="dl-section-desc">Monitor approved users' wallets ‚Äî ensure they maintain required $CIPHER holdings for access</div>

      <div class="ac-stats-row">
        <div class="ac-stat-card">
          <div class="ac-stat-value" id="ac-scan-total">0</div>
          <div class="ac-stat-label">Total Wallets</div>
        </div>
        <div class="ac-stat-card">
          <div class="ac-stat-value" id="ac-scan-healthy">0</div>
          <div class="ac-stat-label">Healthy</div>
        </div>
        <div class="ac-stat-card">
          <div class="ac-stat-value warning" id="ac-scan-warning">0</div>
          <div class="ac-stat-label">Low Balance</div>
        </div>
        <div class="ac-stat-card">
          <div class="ac-stat-value warning" id="ac-scan-danger">0</div>
          <div class="ac-stat-label">Below Threshold</div>
        </div>
      </div>

      <div class="ac-card">
        <div class="ac-card-header">
          <div class="ac-card-title"><span>üîç</span> Wallet Holdings Scanner</div>
          <div>
            <button class="ac-scan-btn" id="acScanAllBtn" onclick="acScanAllWallets()">
              üîÑ Scan All Wallets
            </button>
          </div>
        </div>
        <div class="ac-card-body">
          <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 12px;">
            Monitors all approved users' wallets to ensure they maintain required $CIPHER holdings.
            Users who drop below their tier threshold will be flagged for access revocation.
          </p>
          <div class="ac-scanner-grid" id="ac-scanner-grid">
            <div class="ac-empty-state">
              <div class="ac-empty-state-icon">üîç</div>
              <div>Click "Scan All Wallets" to check holdings</div>
            </div>
          </div>
        </div>
      </div>

      <div class="ac-card">
        <div class="ac-card-header">
          <div class="ac-card-title"><span>‚ö†Ô∏è</span> Revocation Queue</div>
        </div>
        <div class="ac-card-body">
          <table class="ac-table">
            <thead>
              <tr>
                <th>TradingView User</th>
                <th>Access Type</th>
                <th>Required</th>
                <th>Current Balance</th>
                <th>Shortfall</th>
                <th>Grace Period</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="ac-revocation-table">
              <tr>
                <td colspan="7" class="ac-empty-state">No users pending revocation</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê TAB: CALENDAR (Weekly Tasks + Expenses) ‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="tab-calendar">
    <h1 class="section-title">Calendar</h1>
    <p class="section-subtitle">Weekly schedule, tasks & expenses ‚Äî all in one place</p>

    <!-- Weekly Personal Calendar -->
    <div class="personal-calendar-section">
      <div class="personal-cal-header">
        <div>
          <div class="personal-cal-title">üìÖ Weekly Personal Schedule</div>
          <div class="personal-cal-subtitle">Color-coded by category ‚Ä¢ Click to edit ‚Ä¢ + to add</div>
        </div>
        <div class="personal-cal-legend">
          <span class="legend-item"><span class="legend-dot" style="background:#00ff88;"></span>Trading/Bots</span>
          <span class="legend-item"><span class="legend-dot" style="background:#aa66ff;"></span>Content/Social</span>
          <span class="legend-item"><span class="legend-dot" style="background:#00d4ff;"></span>Business/Admin</span>
          <span class="legend-item"><span class="legend-dot" style="background:#ffdd44;"></span>Personal</span>
        </div>
      </div>
      <div class="personal-cal-grid" id="personal-cal-grid"></div>
    </div>

    <!-- Next Up Section -->
    <div class="personal-next-up">
      <div class="countdown-title">‚è± NEXT UP</div>
      <div id="personal-countdown-list"></div>
    </div>

    <!-- Monthly Expenses (moved from Calendar tab) -->
    <div class="expenses-section">
      <div class="expenses-title">üí∏ Monthly Expenses</div>
      <table class="expense-table" id="expense-table">
        <thead>
          <tr>
            <th>Service</th>
            <th>Notes</th>
            <th>Cost</th>
            <th style="width:30px;"></th>
          </tr>
        </thead>
        <tbody id="expense-body"></tbody>
      </table>
      <div class="expense-actions">
        <button class="expense-btn add" onclick="addExpenseRow('business')">+ Add Business</button>
        <button class="expense-btn add" onclick="addExpenseRow('personal')">+ Add Personal</button>
        <button class="expense-btn save" onclick="saveExpenses()">üíæ Save Changes</button>
      </div>
      <div class="expense-total" id="expense-totals" style="display:flex;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-top:16px;">
      </div>
    </div>
  </div>

</div>

  <!-- ‚ïê‚ïê‚ïê TAB: IDEAS ‚ïê‚ïê‚ïê -->
  <div class="tab-content" id="tab-ideas">
    <h1 class="section-title">üí° Ideas Lab</h1>
    <p class="section-subtitle">Brainstorms, experiments & future projects ‚Äî capture everything</p>

    <div style="display:flex;gap:12px;margin-bottom:20px;">
      <button onclick="addIdea()" style="background:linear-gradient(135deg,#00ffc8,#00b894);color:#0a0e17;border:none;padding:10px 20px;border-radius:8px;font-weight:700;cursor:pointer;font-size:14px;">+ New Idea</button>
      <select id="idea-filter" onchange="renderIdeas()" style="background:#1a1e2e;color:#e0e0e0;border:1px solid #2a2e3e;padding:8px 14px;border-radius:8px;font-size:13px;">
        <option value="all">All Ideas</option>
        <option value="hot">üî• Hot</option>
        <option value="backlog">üìã Backlog</option>
        <option value="in-progress">üöß In Progress</option>
        <option value="done">‚úÖ Done</option>
        <option value="trading">üìà Trading</option>
        <option value="content">üé¨ Content</option>
        <option value="product">üõ†Ô∏è Product</option>
        <option value="token">ü™ô Token</option>
      </select>
    </div>

    <div id="ideas-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px;"></div>
  </div>

<!-- Refresh indicator -->
<div class="refresh-indicator">
  <span class="pulse-dot"></span>
  <span id="last-refresh">‚Äî</span>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const state = {
  accounts: {},
  signals: [],
  stats: {},
  healthy: false,
  lastRefresh: null
};

// Bot definitions
const BOTS = [
  { id: 'tina', botId: 'fvg-ifvg-1', name: 'Technical Tina', number: '#13', strategy: 'FVG+IFVG Strategy', account: 'APEX-18', emoji: 'üîß', desc: 'Determines order flow using Fair Value Gaps and Inverse FVGs. Trades during ICT macro windows: Accumulation, Pre-NY, NY Open, Silver Bullet, and London Close.' },
  { id: 'danny', botId: 'ote-silver-bullet', name: 'Diamond Hands Danny', number: '#01', strategy: 'OTE Silver Bullet', account: 'APEX-19', emoji: 'üíé', desc: 'Executes Silver Bullet entries at Optimal Trade Entry levels. Focuses on the 10:00-11:00 AM ET silver bullet window for high-probability setups.' },
  { id: 'annie', botId: 'ote-refined-small', name: 'Algo Annie', number: '#05', strategy: 'OTE Refined', account: 'APEX-20', emoji: 'üìä', desc: 'Refined OTE strategy with enhanced entry/exit logic. Focuses on confluence of OTE levels with displacement and market structure shifts.' },
  { id: 'mike', botId: 'new-300k', name: 'Moon Mission Mike', number: '#03', strategy: 'OTE Silver Bullet', account: 'APEX-21', emoji: 'üöÄ', desc: 'The big gun. Runs OTE Silver Bullet on our largest account ‚Äî a $300K evaluation. Same sniper precision with bigger stakes.' }
];

// Task data ‚Äî persisted to API + localStorage
const DEFAULT_TASKS = [
  { id: 1, title: 'Set up Rithmic accounts', desc: 'Migrate from Tradovate to Rithmic for better drawdown rules', priority: 'high', assignee: 'DropKing', column: 'todo' },
  { id: 2, title: 'Backtest FVG+IFVG refinements', desc: 'Test new entry filter on 2-week historical data', priority: 'medium', assignee: 'Jimmy', column: 'todo' },
  { id: 3, title: 'Build caretaker dashboard', desc: 'Mission control UI for the caretaker server', priority: 'high', assignee: 'Jimmy', column: 'done' },
  { id: 4, title: 'Discord bot-performance auto-post', desc: 'Auto-post daily P&L to #bot-performance channel', priority: 'medium', assignee: 'Jimmy', column: 'in-progress' },
  { id: 5, title: 'Add PM session risk management', desc: 'Auto-pause bots when green before PM session', priority: 'high', assignee: 'Jimmy', column: 'in-progress' },
  { id: 6, title: 'Landing page live', desc: 'Deploy decryptlabs.io via Cloudflare Pages', priority: 'high', assignee: 'Jimmy', column: 'done' },
  { id: 7, title: 'ICT analysis webhook pipeline', desc: 'Signal pipeline from TradingView to API', priority: 'medium', assignee: 'Jimmy', column: 'done' },
  { id: 8, title: 'Apex PA payout processing', desc: 'Waiting on Apex to approve PA status', priority: 'low', assignee: 'DropKing', column: 'blocked' },
  { id: 9, title: 'Add trailing drawdown to dashboard', desc: 'Show live drawdown gauge per bot', priority: 'medium', assignee: 'Jimmy', column: 'done' },
  { id: 10, title: 'Twitter auto-post market analysis', desc: 'Post daily analysis to @PriceCipherHQ', priority: 'low', assignee: 'Jimmy', column: 'todo' },
  { id: 11, title: 'Build mint-to-bot pipeline', desc: 'When someone mints an NFT, auto-assign to a trading bot slot with ‚è≥ Pending label', priority: 'high', assignee: 'Carl', column: 'todo' },
  { id: 12, title: 'Pre-load NFT archive for minting', desc: 'All 20 Cipher Bot NFTs available to mint from day one ‚Äî not on-demand', priority: 'high', assignee: 'Carl', column: 'todo' },
  { id: 13, title: 'Add "Share to X" post-mint button', desc: 'After minting, user can tweet about their NFT with pre-filled template + @PriceCipherHQ', priority: 'medium', assignee: 'Carl', column: 'todo' },
  { id: 14, title: 'Minted NFT appears on dashboard', desc: 'New mint shows on dashboard + holder page immediately with ‚è≥ Pending status', priority: 'high', assignee: 'Carl', column: 'todo' },
  { id: 15, title: 'Nightly mint activation checklist', desc: 'Documented process for activating new mints each evening ‚Äî Pending ‚Üí üü¢ Active', priority: 'medium', assignee: 'Jimmy', column: 'todo' },
  { id: 16, title: 'Add minted NFT to Cipher City', desc: 'Minted bot must appear in the 3D city dashboard alongside existing bots', priority: 'medium', assignee: 'Carl', column: 'todo' },
];
let kanbanTasks = [...DEFAULT_TASKS];
let kanbanNextId = 100;

// Schedule data
const SCHEDULE = {
  daily: [
    { name: 'Accumulation Macro', time: '00:50', color: 'purple', hour: 0, min: 50 },
    { name: 'Balance Scrape', time: '5:00 AM', color: 'cyan', hour: 5, min: 0 },
    { name: 'Pre-NY Macro', time: '5:50 AM', color: 'green', hour: 5, min: 50 },
    { name: 'NY Open Macro', time: '8:50 AM', color: 'orange', hour: 8, min: 50 },
    { name: 'Silver Bullet', time: '9:50 AM', color: 'yellow', hour: 9, min: 50 },
    { name: 'London Close', time: '10:50 AM', color: 'red', hour: 10, min: 50 },
  ],
  special: {
    2: [{ name: 'Market Analysis Post', time: '7:00 AM', color: 'purple', hour: 7, min: 0 }], // Tuesday
    4: [{ name: 'Market Analysis Post', time: '7:00 AM', color: 'purple', hour: 7, min: 0 }], // Thursday
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TAB SWITCHING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.querySelectorAll('.nav-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    tab.classList.add('active');
    const target = tab.getAttribute('data-tab');
    document.getElementById('tab-' + target).classList.add('active');
  });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê API FETCHING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function fetchData() {
  try {
    // Fetch health
    const healthRes = await fetch('/health', { signal: AbortSignal.timeout(5000) }).catch(() => null);
    if (healthRes && healthRes.ok) {
      const health = await healthRes.json();
      state.healthy = true;
      document.getElementById('health-dot').className = 'status-dot green';
      document.getElementById('health-text').textContent = 'Online';
    } else {
      state.healthy = false;
      document.getElementById('health-dot').className = 'status-dot red';
      document.getElementById('health-text').textContent = 'Offline';
    }
  } catch(e) {
    document.getElementById('health-dot').className = 'status-dot red';
    document.getElementById('health-text').textContent = 'Offline';
  }

  try {
    const accRes = await fetch('/api/accounts', { signal: AbortSignal.timeout(5000) }).catch(() => null);
    if (accRes && accRes.ok) {
      const data = await accRes.json();
      state.accounts = data;
      updateAccountsUI(data);
    }
  } catch(e) { console.warn('Failed to fetch accounts:', e); }

  try {
    const sigRes = await fetch('/api/signals/ict', { signal: AbortSignal.timeout(5000) }).catch(() => null);
    if (sigRes && sigRes.ok) {
      const data = await sigRes.json();
      state.signals = Array.isArray(data) ? data : (data.signals || []);
      updateSignalsUI();
    }
  } catch(e) { console.warn('Failed to fetch ICT signals:', e); }

  try {
    const statsRes = await fetch('/api/stats', { signal: AbortSignal.timeout(5000) }).catch(() => null);
    if (statsRes && statsRes.ok) {
      const data = await statsRes.json();
      state.stats = data;
      updateStatsUI(data);
    }
  } catch(e) { console.warn('Failed to fetch stats:', e); }

  state.lastRefresh = new Date();
  document.getElementById('last-refresh').textContent = 'Updated ' + state.lastRefresh.toLocaleTimeString();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UI UPDATES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateAccountsUI(data) {
  // API returns object keyed by bot-id ‚Äî convert to array
  let accounts;
  if (Array.isArray(data)) {
    accounts = data;
  } else if (data.accounts && Array.isArray(data.accounts)) {
    accounts = data.accounts;
  } else {
    // Object keyed by bot ID ‚Äî convert
    accounts = Object.entries(data).map(([id, acc]) => ({ id, ...acc }));
  }
  let totalAUM = 0;
  let totalPnl = 0;
  let activeBots = 0;

  accounts.forEach(acc => {
    const balance = parseFloat(acc.balance || acc.equity || 0);
    const pnl = parseFloat(acc.pnl || acc.todayPnl || 0);
    totalAUM += balance;
    totalPnl += pnl;
    if (acc.status === 'active' || acc.active) activeBots++;
  });

  if (totalAUM > 0) {
    document.getElementById('stat-aum').textContent = '$' + totalAUM.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0});
  }
  if (activeBots > 0) {
    document.getElementById('stat-bots').textContent = activeBots + '/' + accounts.length;
  }
  if (totalPnl !== 0) {
    const pnlEl = document.getElementById('stat-pnl');
    const prefix = totalPnl >= 0 ? '+$' : '-$';
    pnlEl.textContent = prefix + Math.abs(totalPnl).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
    pnlEl.style.color = totalPnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
  }

  // Update bots grid in Decrypt Labs tab
  renderBotsTab(accounts);
}

function updateSignalsUI() {
  const signals = state.signals.slice(0, 20);
  
  // Count 24h signals
  const now = Date.now();
  const dayAgo = now - 86400000;
  const recent24h = state.signals.filter(s => {
    const t = new Date(s.timestamp || s.time || s.created).getTime();
    return t > dayAgo;
  });
  document.getElementById('stat-signals').textContent = recent24h.length.toString();

  // ICT Signals feed (Decrypt Labs tab) ‚Äî isolated pipeline
  const feedEl = document.getElementById('signals-feed');
  if (signals.length === 0) {
    feedEl.innerHTML = '<div class="empty-state"><div class="icon">üì°</div><div class="message">No ICT signals received yet. Signals appear when macro windows trigger.</div></div>';
  } else {
    feedEl.innerHTML = signals.map(s => {
      const bias = (s.bias || 'neutral').toString().toLowerCase();
      const cardClass = bias.includes('bull') ? 'bullish' : bias.includes('bear') ? 'bearish' : 'neutral';
      const confVal = parseFloat(s.confidence) || 0;
      const confPct = confVal > 1 ? confVal : Math.round(confVal * 100);
      const confClass = confPct >= 70 ? 'confidence-high' : confPct >= 50 ? 'confidence-medium' : 'confidence-low';
      const time = s.timestamp || '';
      const timeStr = time ? new Date(time).toLocaleString() : '';
      const modelName = (s.model || '').replace(/_/g, ' ');
      
      return `
        <div class="signal-card ${cardClass}">
          <div class="signal-card-header">
            <div class="signal-trigger">${s.trigger || 'Signal'}</div>
            <span class="signal-confidence ${confClass}">${confPct}%</span>
          </div>
          <div class="signal-body">
            <div><div class="signal-field-label">Bias</div><div class="signal-field-value">${s.bias || '‚Äî'}</div></div>
            <div><div class="signal-field-label">Model</div><div class="signal-field-value">${modelName || '‚Äî'}</div></div>
            <div><div class="signal-field-label">Key Level</div><div class="signal-field-value">${s.keyLevel || '‚Äî'}</div></div>
            <div><div class="signal-field-label">Instrument</div><div class="signal-field-value">${s.instrument || 'MNQ'}</div></div>
            ${s.biasReason ? `<div style="grid-column:1/-1"><div class="signal-field-label">Reason</div><div class="signal-field-value" style="font-size:11px;color:var(--text-secondary)">${s.biasReason}</div></div>` : ''}
            ${s.entryZone ? `<div><div class="signal-field-label">Entry Zone</div><div class="signal-field-value">${s.entryZone}</div></div>` : ''}
            ${s.dol ? `<div><div class="signal-field-label">Draw on Liquidity</div><div class="signal-field-value">${s.dol}</div></div>` : ''}
          </div>
          <div class="signal-timestamp">${timeStr}</div>
        </div>`;
    }).join('');
  }
}

function updateStatsUI(data) {
  if (data.aum) document.getElementById('stat-aum').textContent = '$' + parseFloat(data.aum).toLocaleString();
  if (data.activeBots != null) document.getElementById('stat-bots').textContent = data.activeBots + '/' + BOTS.length;
  if (data.todayPnl != null) {
    const pnl = parseFloat(data.todayPnl);
    const prefix = pnl >= 0 ? '+$' : '-$';
    const el = document.getElementById('stat-pnl');
    el.textContent = prefix + Math.abs(pnl).toLocaleString(undefined, {minimumFractionDigits: 2});
    el.style.color = pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BOTS (Decrypt Labs Tab) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderBotsTab(accounts) {
  const grid = document.getElementById('bots-grid');
  grid.innerHTML = BOTS.map(bot => {
    // Match by exact bot ID first, then by name
    const acc = accounts?.find(a => a.id && a.id === bot.botId) ||
                accounts?.find(a => a.name && a.name.includes(bot.name.split(' ')[0]));
    
    const balance = acc ? parseFloat(acc.balance || acc.equity || 150000) : 150000;
    const pnl = acc ? parseFloat(acc.pnl || acc.todayPnl || 0) : 0;
    const peak = acc ? parseFloat(acc.peakBalance || acc.peak || balance) : balance;
    const startBal = (bot.botId === 'new-300k') ? 300000 : 150000;
    const ddMax = (bot.botId === 'new-300k') ? 7500 : 5000;
    const profitTarget = (bot.botId === 'new-300k') ? 320000 : 159000;
    const profitRange = profitTarget - startBal;
    const threshold = peak - ddMax;
    const drawdownUsed = peak - balance;
    const drawdownPct = Math.min((drawdownUsed / ddMax) * 100, 100);
    const progressPct = Math.min(Math.max(((balance - startBal) / profitRange) * 100, 0), 100);
    const winRate = acc?.winRate || acc?.win_rate || '‚Äî';
    const totalTrades = acc?.totalTrades || acc?.trades || '‚Äî';
    const gaugeClass = drawdownPct > 70 ? 'danger' : drawdownPct > 40 ? 'warning' : 'safe';

    // Generate mini chart bars
    const chartBars = Array.from({length: 20}, () => {
      const val = Math.random() * 100 - 30;
      return `<div class="chart-bar ${val >= 0 ? 'positive' : 'negative'}" style="height:${Math.abs(val) * 0.4}px"></div>`;
    }).join('');

    return `
      <div class="bot-card">
        <div class="bot-card-header">
          <div class="bot-card-avatar">${bot.emoji}</div>
          <div style="flex:1">
            <div class="bot-card-name">${bot.name} (${bot.number})</div>
            <div class="bot-card-subtitle">${bot.strategy} ‚Ä¢ ${bot.account}</div>
          </div>
          <span class="status-dot green"></span>
        </div>

        <div class="bot-card-stats">
          <div class="bot-stat">
            <div class="bot-stat-label">Balance</div>
            <div class="bot-stat-value" style="color:var(--accent-cyan)">$${balance.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}</div>
          </div>
          <div class="bot-stat">
            <div class="bot-stat-label">Today's P&L</div>
            <div class="bot-stat-value" style="color:${pnl >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">${pnl >= 0 ? '+' : ''}$${pnl.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</div>
          </div>
        </div>

        <div class="mini-chart">${chartBars}</div>

        <div class="progress-section">
          <div class="progress-header">
            <span style="color:var(--text-secondary)">Progress to Funded ($${profitTarget.toLocaleString()})</span>
            <span style="color:var(--accent-cyan)">${progressPct.toFixed(1)}%</span>
          </div>
          <div class="progress-bar"><div class="progress-fill" style="width:${progressPct}%"></div></div>
        </div>

        <div class="drawdown-gauge">
          <div class="gauge-header">
            <span class="gauge-label">Trailing Drawdown (Max $${ddMax.toLocaleString()})</span>
            <span class="gauge-value">$${drawdownUsed.toLocaleString(undefined, {minimumFractionDigits: 2})} used</span>
          </div>
          <div class="gauge-bar"><div class="gauge-fill ${gaugeClass}" style="width:${drawdownPct}%"></div></div>
          <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--text-dim);margin-top:4px">
            <span>Threshold: $${threshold.toLocaleString(undefined, {minimumFractionDigits: 0})}</span>
            <span>Remaining: $${(ddMax - drawdownUsed).toLocaleString(undefined, {minimumFractionDigits: 2})}</span>
          </div>
        </div>

        <div class="bot-card-footer">
          <span>Win Rate: ${winRate}${typeof winRate === 'number' ? '%' : ''}</span>
          <span>Trades: ${totalTrades}</span>
          <span>${bot.strategy}</span>
        </div>

        <p style="font-size:11px;color:var(--text-dim);margin-top:12px;line-height:1.5">${bot.desc}</p>
      </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê KANBAN (PERSISTENT) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadKanbanTasks() {
  try {
    const saved = localStorage.getItem('decrypt-kanban-tasks');
    if (saved) {
      const parsed = JSON.parse(saved);
      if (Array.isArray(parsed) && parsed.length > 0) return parsed;
    }
  } catch(e) {}
  return [...DEFAULT_TASKS];
}

async function loadKanbanFromAPI() {
  try {
    const res = await fetch('/api/kanban-tasks');
    if (res.ok) {
      const data = await res.json();
      if (Array.isArray(data) && data.length > 0) {
        localStorage.setItem('decrypt-kanban-tasks', JSON.stringify(data));
        return data;
      }
    }
  } catch(e) { console.warn('Kanban API load failed, using localStorage'); }
  const local = loadKanbanTasks();
  // Push local to API as initial sync
  fetch('/api/kanban-tasks', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(local) }).catch(() => {});
  return local;
}

async function saveKanbanTasks() {
  localStorage.setItem('decrypt-kanban-tasks', JSON.stringify(kanbanTasks));
  try {
    await fetch('/api/kanban-tasks', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(kanbanTasks) });
  } catch(e) { console.warn('Kanban API save failed ‚Äî saved locally'); }
}

function renderKanban() {
  const columns = { todo: [], 'in-progress': [], done: [], blocked: [] };
  kanbanTasks.forEach(t => {
    if (columns[t.column]) columns[t.column].push(t);
  });

  Object.keys(columns).forEach(col => {
    const el = document.getElementById('col-' + col);
    document.getElementById('count-' + col).textContent = columns[col].length;
    el.innerHTML = columns[col].map(t => `
      <div class="task-card" draggable="true" data-task-id="${t.id}" onclick="editKanbanTask(${t.id})">
        <div class="task-title">${escapeHtml(t.title)}</div>
        <div class="task-desc">${escapeHtml(t.desc)}</div>
        <div class="task-meta">
          <span class="task-tag ${t.priority}">${t.priority}</span>
          <span class="task-assignee">${escapeHtml(t.assignee)}</span>
        </div>
      </div>
    `).join('');
  });

  setupDragDrop();
}

function setupDragDrop() {
  let draggedId = null;

  document.querySelectorAll('.task-card').forEach(card => {
    card.addEventListener('dragstart', (e) => {
      draggedId = parseInt(card.dataset.taskId);
      card.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      // Prevent click from firing after drag
      card._dragged = true;
    });
    card.addEventListener('dragend', () => {
      card.classList.remove('dragging');
      setTimeout(() => { card._dragged = false; }, 50);
    });
    // Override click so drag doesn't trigger edit
    const origClick = card.onclick;
    card.onclick = function(e) {
      if (this._dragged) { this._dragged = false; return; }
      if (origClick) origClick.call(this, e);
    };
  });

  document.querySelectorAll('.kanban-items').forEach(col => {
    col.addEventListener('dragover', (e) => {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      const dragging = document.querySelector('.dragging');
      if (dragging) col.appendChild(dragging);
    });

    col.addEventListener('drop', (e) => {
      e.preventDefault();
      if (draggedId == null) return;
      const newColumn = col.id.replace('col-', '');
      const task = kanbanTasks.find(t => t.id === draggedId);
      if (task && task.column !== newColumn) {
        task.column = newColumn;
        saveKanbanTasks();
        renderKanban();
      }
      draggedId = null;
    });
  });
}

function addKanbanTask(column) {
  showKanbanEditModal(-1, { title: '', desc: '', priority: 'medium', assignee: 'Jimmy', column: column || 'todo' });
}

function editKanbanTask(id) {
  const task = kanbanTasks.find(t => t.id === id);
  if (task) showKanbanEditModal(id, task);
}

function showKanbanEditModal(id, task) {
  let overlay = document.getElementById('kanban-edit-overlay');
  if (!overlay) {
    overlay = document.createElement('div');
    overlay.id = 'kanban-edit-overlay';
    overlay.className = 'pcal-edit-overlay';
    overlay.innerHTML = '<div class="pcal-edit-modal" id="kanban-edit-modal"></div>';
    overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.classList.remove('active'); });
    document.body.appendChild(overlay);
  }

  const isNew = id === -1;
  const modal = document.getElementById('kanban-edit-modal');
  modal.innerHTML = `
    <h3>${isNew ? '‚ûï New Task' : '‚úèÔ∏è Edit Task'}</h3>
    <label>Title</label>
    <input type="text" id="kb-edit-title" value="${escapeHtml(task.title)}" placeholder="Task title...">
    <label>Description</label>
    <input type="text" id="kb-edit-desc" value="${escapeHtml(task.desc)}" placeholder="Brief description...">
    <label>Priority</label>
    <select id="kb-edit-priority">
      <option value="high" ${task.priority==='high'?'selected':''}>üî¥ High</option>
      <option value="medium" ${task.priority==='medium'?'selected':''}>üü† Medium</option>
      <option value="low" ${task.priority==='low'?'selected':''}>üîµ Low</option>
    </select>
    <label>Assignee</label>
    <select id="kb-edit-assignee">
      <option value="Jimmy" ${task.assignee==='Jimmy'?'selected':''}>üß™ Jimmy</option>
      <option value="DropKing" ${task.assignee==='DropKing'?'selected':''}>üëë DropKing</option>
      <option value="Carl" ${task.assignee==='Carl'?'selected':''}>ü§ì Carl</option>
      <option value="Cindy" ${task.assignee==='Cindy'?'selected':''}>‚ö° Cindy</option>
      <option value="Sheen" ${task.assignee==='Sheen'?'selected':''}>üöÄ Sheen</option>
    </select>
    <label>Column</label>
    <select id="kb-edit-column">
      <option value="todo" ${task.column==='todo'?'selected':''}>üìã To Do</option>
      <option value="in-progress" ${task.column==='in-progress'?'selected':''}>üîß In Progress</option>
      <option value="done" ${task.column==='done'?'selected':''}>‚úÖ Done</option>
      <option value="blocked" ${task.column==='blocked'?'selected':''}>üö´ Blocked</option>
    </select>
    <div class="pcal-edit-actions">
      ${!isNew ? '<button class="pcal-delete-btn" onclick="deleteKanbanTask('+id+')">üóë</button>' : ''}
      <button class="pcal-cancel-btn" onclick="document.getElementById(\'kanban-edit-overlay\').classList.remove(\'active\')">CANCEL</button>
      <button class="pcal-save-btn" onclick="saveKanbanEdit(${id})">SAVE</button>
    </div>
  `;

  overlay.classList.add('active');
  setTimeout(() => document.getElementById('kb-edit-title').focus(), 100);
}

function saveKanbanEdit(id) {
  const title = document.getElementById('kb-edit-title').value.trim();
  const desc = document.getElementById('kb-edit-desc').value.trim();
  const priority = document.getElementById('kb-edit-priority').value;
  const assignee = document.getElementById('kb-edit-assignee').value;
  const column = document.getElementById('kb-edit-column').value;

  if (!title) return;

  if (id === -1) {
    // New task
    kanbanTasks.push({ id: kanbanNextId++, title, desc, priority, assignee, column });
  } else {
    const task = kanbanTasks.find(t => t.id === id);
    if (task) {
      task.title = title;
      task.desc = desc;
      task.priority = priority;
      task.assignee = assignee;
      task.column = column;
    }
  }

  saveKanbanTasks();
  renderKanban();
  document.getElementById('kanban-edit-overlay').classList.remove('active');
}

function deleteKanbanTask(id) {
  if (!confirm('Delete this task?')) return;
  kanbanTasks = kanbanTasks.filter(t => t.id !== id);
  saveKanbanTasks();
  renderKanban();
  document.getElementById('kanban-edit-overlay').classList.remove('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CALENDAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderCalendar() {
  const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  const grid = document.getElementById('calendar-grid');
  
  grid.innerHTML = days.map((day, i) => {
    let events = SCHEDULE.daily.map(e => `
      <div class="cal-event ${e.color}">
        ${e.name}
        <div class="cal-event-time">${e.time}</div>
      </div>
    `).join('');

    // Add special events
    if (SCHEDULE.special[i]) {
      events += SCHEDULE.special[i].map(e => `
        <div class="cal-event ${e.color}">
          ${e.name}
          <div class="cal-event-time">${e.time}</div>
        </div>
      `).join('');
    }

    return `
      <div class="cal-day">
        <div class="cal-day-name">${day}</div>
        ${events}
      </div>
    `;
  }).join('');

  updateCountdowns();
}

function updateCountdowns() {
  const container = document.getElementById('countdown-list');
  const now = new Date();
  const today = now.getDay();
  
  // Build list of upcoming events
  const upcoming = [];
  
  for (let dayOffset = 0; dayOffset < 7; dayOffset++) {
    const dayIdx = (today + dayOffset) % 7;
    const events = [...SCHEDULE.daily];
    if (SCHEDULE.special[dayIdx]) events.push(...SCHEDULE.special[dayIdx]);
    
    events.forEach(e => {
      const eventDate = new Date(now);
      eventDate.setDate(eventDate.getDate() + dayOffset);
      eventDate.setHours(e.hour, e.min, 0, 0);
      
      if (eventDate > now) {
        const diff = eventDate - now;
        const hours = Math.floor(diff / 3600000);
        const mins = Math.floor((diff % 3600000) / 60000);
        let timeStr;
        if (hours > 48) {
          timeStr = `in ${Math.floor(hours / 24)} days`;
        } else if (hours > 0) {
          timeStr = `in ${hours}h ${mins}m`;
        } else {
          timeStr = `in ${mins} min`;
        }
        
        upcoming.push({
          name: e.name,
          color: e.color,
          timeStr,
          diff
        });
      }
    });
  }
  
  upcoming.sort((a, b) => a.diff - b.diff);
  
  container.innerHTML = upcoming.slice(0, 8).map(u => {
    const colorMap = { cyan: 'var(--accent-cyan)', green: 'var(--accent-green)', purple: 'var(--accent-purple)', orange: 'var(--accent-orange)', red: 'var(--accent-red)', yellow: 'var(--accent-yellow)' };
    return `
      <div class="countdown-item">
        <div class="countdown-label">
          <span class="dot" style="background:${colorMap[u.color] || 'var(--text-dim)'}"></span>
          ${u.name}
        </div>
        <div class="countdown-value">${u.timeStr}</div>
      </div>
    `;
  }).join('');
}

// Upcoming schedule on mission control
function renderUpcomingSchedule() {
  const container = document.getElementById('upcoming-schedule');
  const now = new Date();
  const today = now.getDay();
  const upcoming = [];
  
  for (let dayOffset = 0; dayOffset < 2; dayOffset++) {
    const dayIdx = (today + dayOffset) % 7;
    const events = [...SCHEDULE.daily];
    if (SCHEDULE.special[dayIdx]) events.push(...SCHEDULE.special[dayIdx]);
    
    events.forEach(e => {
      const eventDate = new Date(now);
      eventDate.setDate(eventDate.getDate() + dayOffset);
      eventDate.setHours(e.hour, e.min, 0, 0);
      
      if (eventDate > now) {
        const diff = eventDate - now;
        const hours = Math.floor(diff / 3600000);
        const mins = Math.floor((diff % 3600000) / 60000);
        let timeStr = hours > 0 ? `in ${hours}h ${mins}m` : `in ${mins} min`;
        
        upcoming.push({ name: e.name, timeStr, diff });
      }
    });
  }
  
  upcoming.sort((a, b) => a.diff - b.diff);
  
  container.innerHTML = upcoming.slice(0, 6).map(u => `
    <div class="upcoming-task">
      <span class="upcoming-task-name">${u.name}</span>
      <span class="upcoming-task-time">${u.timeStr}</span>
    </div>
  `).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function init() {
  // Load kanban from API (async), render with defaults first
  kanbanTasks = loadKanbanTasks();
  kanbanNextId = Math.max(...kanbanTasks.map(t => t.id || 0), 99) + 1;
  renderKanban();
  loadKanbanFromAPI().then(data => {
    kanbanTasks = data;
    kanbanNextId = Math.max(...kanbanTasks.map(t => t.id || 0), 99) + 1;
    renderKanban();
  });

  // ‚ïê‚ïê‚ïê Pipeline Status Updater ‚ïê‚ïê‚ïê
  async function updatePipelineStatus() {
    try {
      // Check Caretaker health (Step 2)
      const healthRes = await fetch('/health', { signal: AbortSignal.timeout(5000) }).catch(() => null);
      const step2El = document.getElementById('pipe-step2-status');
      if (healthRes && healthRes.ok) {
        step2El.innerHTML = '<span class="status-dot green"></span> Online';
        step2El.style.background = 'rgba(0,255,136,0.08)';
      } else {
        step2El.innerHTML = '<span class="status-dot red"></span> Offline';
        step2El.style.background = 'rgba(255,68,68,0.08)';
      }

      // Check ICT signals count & last signal time (Steps 1 & 5)
      const sigRes = await fetch('/api/signals/ict', { signal: AbortSignal.timeout(5000) }).catch(() => null);
      if (sigRes && sigRes.ok) {
        const signals = await sigRes.json();
        const sigArray = Array.isArray(signals) ? signals : (signals.signals || []);
        document.getElementById('pipe-signal-count').textContent = sigArray.length;
        
        if (sigArray.length > 0) {
          const latest = sigArray[sigArray.length - 1];
          const ts = latest.timestamp || latest.receivedAt || latest.ts;
          if (ts) {
            const d = new Date(ts);
            const ago = Math.floor((Date.now() - d.getTime()) / 60000);
            let agoStr = ago < 60 ? `${ago}m ago` : ago < 1440 ? `${Math.floor(ago/60)}h ago` : `${Math.floor(ago/1440)}d ago`;
            document.getElementById('pipe-last-signal-time').textContent = d.toLocaleTimeString() + ` (${agoStr})`;
          }
        } else {
          document.getElementById('pipe-last-signal-time').textContent = 'No signals yet';
        }
        
        // Step 5 status
        const step5El = document.getElementById('pipe-step5-status');
        step5El.innerHTML = `<span class="status-dot green"></span> ${sigArray.length} signals`;
        step5El.style.background = 'rgba(170,102,255,0.08)';
      }
    } catch(e) {
      console.warn('Pipeline status check failed:', e);
    }
  }

  // Render static content
  renderCalendar();
  renderUpcomingSchedule();
  renderBotsTab([]); // Render with defaults
  updatePipelineStatus(); // Initial pipeline status check

  // Fetch live data
  fetchData();

  // Auto-refresh every 30 seconds
  setInterval(() => {
    fetchData();
    updateCountdowns();
    renderUpcomingSchedule();
    updatePipelineStatus();
  }, 30000);

  // Update countdowns every minute
  setInterval(() => {
    updateCountdowns();
    renderUpcomingSchedule();
  }, 60000);
}

init();

// ‚ïê‚ïê‚ïê EDITABLE EXPENSES ‚ïê‚ïê‚ïê
const DEFAULT_EXPENSES = [
  { cat: 'business', name: 'Apex Trader Funding', note: '$78.40 √ó 4 accounts + $50 data', cost: 363.60 },
  { cat: 'business', name: 'TradersPost', note: 'Webhook automation', cost: 41.40 },
  { cat: 'business', name: 'TradingView', note: 'Charts & alerts', cost: 7.00 },
  { cat: 'business', name: 'Spline Design', note: '3D design tool', cost: 30.00 },
  { cat: 'business', name: 'Railway Hosting', note: 'Caretaker API server', cost: 5.00 },
  { cat: 'business', name: 'ElevenLabs TTS', note: 'Starter plan ‚Äî voiceovers', cost: 5.00 },
  { cat: 'business', name: 'OpenClaw / Claude API', note: "Jimmy's brain", cost: 40.00 },
  { cat: 'business', name: 'Cloudflare Pages', note: 'decryptlabs.io hosting', cost: 0 },
  { cat: 'personal', name: 'Verizon Wireless', note: 'Phone plan', cost: 173.37 },
  { cat: 'personal', name: 'Starlink', note: 'Internet', cost: 165.00 },
  { cat: 'personal', name: 'Self Storage', note: 'Hesperia', cost: 178.00 },
  { cat: 'personal', name: 'Root Insurance', note: 'Auto insurance', cost: 155.97 },
  { cat: 'personal', name: 'Affirm', note: 'Payment plan', cost: 67.50 },
  { cat: 'personal', name: 'Amazon Prime', note: 'Membership', cost: 16.15 },
  { cat: 'personal', name: 'Apple', note: 'iCloud / subscriptions', cost: 3.99 },
  { cat: 'personal', name: 'Samsung', note: 'Samsung subscription', cost: 0.99 },
];

function loadExpenses() {
  try {
    const saved = localStorage.getItem('decrypt-expenses');
    return saved ? JSON.parse(saved) : [...DEFAULT_EXPENSES];
  } catch(e) { return [...DEFAULT_EXPENSES]; }
}

async function loadExpensesFromAPI() {
  try {
    const res = await fetch('/api/expenses');
    if (res.ok) {
      const data = await res.json();
      if (Array.isArray(data) && data.length > 0) {
        // API is the source of truth ‚Äî always use it over localStorage
        localStorage.setItem('decrypt-expenses', JSON.stringify(data));
        return data;
      }
    }
  } catch(e) { console.warn('API expenses load failed, using localStorage fallback'); }
  // Fallback: localStorage, then defaults
  const local = loadExpenses();
  // If we have local data that isn't defaults, push it to the API
  if (local.length > 0) {
    fetch('/api/expenses', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(local) }).catch(() => {});
  }
  return local;
}

async function saveExpenses() {
  const rows = document.querySelectorAll('#expense-body tr[data-idx]');
  const expenses = [];
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    const costText = cells[2].textContent.replace(/[^0-9.]/g, '');
    expenses.push({
      cat: row.dataset.cat,
      name: cells[0].textContent.trim(),
      note: cells[1].textContent.trim(),
      cost: parseFloat(costText) || 0
    });
  });
  // Save to localStorage as cache
  localStorage.setItem('decrypt-expenses', JSON.stringify(expenses));
  // Save to server as source of truth
  try {
    const res = await fetch('/api/expenses', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(expenses) });
    if (res.ok) {
      renderExpenses();
      alert('‚úÖ Expenses saved to server!');
    } else {
      renderExpenses();
      alert('‚ö†Ô∏è Saved locally but server save failed. Try again.');
    }
  } catch(e) {
    renderExpenses();
    alert('‚ö†Ô∏è Saved locally but server unreachable. Will sync next load.');
  }
}

function addExpenseRow(cat) {
  const expenses = loadExpenses();
  expenses.push({ cat, name: 'New Item', note: 'Description', cost: 0 });
  localStorage.setItem('decrypt-expenses', JSON.stringify(expenses));
  renderExpenses();
}

function removeExpenseRow(idx) {
  const expenses = loadExpenses();
  expenses.splice(idx, 1);
  localStorage.setItem('decrypt-expenses', JSON.stringify(expenses));
  renderExpenses();
}

function renderExpenses() {
  const expenses = loadExpenses();
  const tbody = document.getElementById('expense-body');
  if (!tbody) return;
  let html = '';
  let bizTotal = 0, persTotal = 0;
  let lastCat = '';

  expenses.forEach((exp, i) => {
    if (exp.cat !== lastCat) {
      const label = exp.cat === 'business' ? 'üîß Business / Trading' : 'üè† Personal / Bills';
      const color = exp.cat === 'business' ? 'var(--accent-cyan)' : 'var(--accent-purple)';
      html += '<tr><td colspan="4" style="color:' + color + ';font-weight:600;padding-top:12px;">' + label + '</td></tr>';
      lastCat = exp.cat;
    }
    const costDisplay = exp.cost === 0 ? '<span class="expense-free">Free</span>' : '$' + exp.cost.toFixed(2);
    if (exp.cat === 'business') bizTotal += exp.cost;
    else persTotal += exp.cost;
    html += '<tr data-idx="' + i + '" data-cat="' + exp.cat + '">';
    html += '<td class="expense-name" contenteditable="true">' + exp.name + '</td>';
    html += '<td class="expense-note" contenteditable="true">' + exp.note + '</td>';
    html += '<td contenteditable="true">' + costDisplay + '</td>';
    html += '<td><button class="expense-btn remove" onclick="removeExpenseRow(' + i + ')">‚úï</button></td>';
    html += '</tr>';
  });

  tbody.innerHTML = html;

  const totalsDiv = document.getElementById('expense-totals');
  if (totalsDiv) {
    totalsDiv.innerHTML = '<div><div class="expense-total-label" style="font-size:11px;color:var(--accent-cyan);">Business</div><div class="expense-total-value" style="font-size:18px;">$' + bizTotal.toFixed(2) + '/mo</div></div>' +
      '<div><div class="expense-total-label" style="font-size:11px;color:var(--accent-purple);">Personal</div><div class="expense-total-value" style="font-size:18px;">$' + persTotal.toFixed(2) + '/mo</div></div>' +
      '<div><div class="expense-total-label">Total</div><div class="expense-total-value" style="font-size:22px;">$' + (bizTotal + persTotal).toFixed(2) + '/mo</div></div>';
  }
}

renderExpenses();
loadExpensesFromAPI().then(data => { /* expenses loaded */ renderExpenses(); });

// ‚ïê‚ïê‚ïê LAUNCH TO-DO WITH INPUT FIELDS ‚ïê‚ïê‚ïê
const LAUNCH_TASKS = [
  { section: 'done', label: '‚úÖ DONE (JIMMY)', color: 'var(--accent-cyan)', items: [
    { id: 'done-1', text: 'Agent profile written (name, pitch, FAQ)', done: true },
    { id: 'done-2', text: 'Profile picture locked (Jimmy avatar)', done: true },
    { id: 'done-3', text: '7-day X content plan', done: true },
    { id: 'done-4', text: 'Launch announcement drafts (X + Discord)', done: true },
    { id: 'done-5', text: 'Launch checklist (step-by-step)', done: true },
    { id: 'done-6', text: 'Pitch video final cut (82s)', done: true },
    { id: 'done-7', text: 'Website fully wired + deployed', done: true },
    { id: 'done-8', text: 'ICT analysis pipeline built', done: true },
    { id: 'done-9', text: 'Permanent webhook URL (Railway)', done: true },
    { id: 'done-10', text: 'Mission Control dashboard', done: true },
    { id: 'done-11', text: 'Security lockdown (.gitignore, auth)', done: true },
  ]},
  { section: 'dropking', label: '‚è≥ NEEDS DROPKING', color: 'var(--accent-orange)', items: [
    { id: 'dk-1', text: 'Fund wallet with $VIRTUAL on Base', done: false },
    { id: 'dk-2', text: 'Pre-buy budget decision (~$1,700-$2,700)', done: false },
    { id: 'dk-3', text: 'Create agent on app.virtuals.io', done: false },
    { id: 'dk-4', text: 'Pick launch day (Tue/Wed rec)', done: false },
    { id: 'dk-5', text: 'Upload pitch video to X/YouTube', done: false },
    { id: 'dk-6', text: 'Review launch tweets', done: false },
  ]},
  { section: 'post', label: 'üìã POST-LAUNCH (JIMMY)', color: 'var(--accent-green)', items: [
    { id: 'pl-1', text: 'Deploy contracts to Base Mainnet', done: false },
    { id: 'pl-2', text: 'Update X bio with contract address', done: false },
    { id: 'pl-3', text: 'Submit CoinGecko listing', done: false },
    { id: 'pl-4', text: 'Submit CoinMarketCap listing', done: false },
    { id: 'pl-5', text: 'First buyback & burn transaction', done: false },
    { id: 'pl-6', text: 'Run ICT pipeline ‚Üí post on @PriceCipherHQ', done: false },
  ]}
];

function loadTodoState() {
  try {
    return JSON.parse(localStorage.getItem('launch-todo-state') || '{}');
  } catch(e) { return {}; }
}

function saveTodoState(state) {
  localStorage.setItem('launch-todo-state', JSON.stringify(state));
}

function sendToJimmy(taskId, taskText, note) {
  // POST to caretaker which logs it ‚Äî Jimmy polls this
  fetch('/api/todo-update', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ taskId, task: taskText, note, timestamp: new Date().toISOString() })
  }).catch(() => {});
}

function renderLaunchTodo() {
  const container = document.getElementById('launch-todo');
  if (!container) return;
  const todoState = loadTodoState();

  let leftHtml = '';
  let rightHtml = '';

  LAUNCH_TASKS.forEach(section => {
    const sectionHtml = `<div style="font-size:11px;color:${section.color};font-weight:600;margin-bottom:8px;${section.section === 'post' ? 'margin-top:16px;' : ''}font-family:'Orbitron',sans-serif;">${section.label}</div>`;

    let itemsHtml = sectionHtml;
    section.items.forEach(item => {
      const saved = todoState[item.id] || {};
      const isDone = saved.done || item.done;
      const check = isDone ? '‚úÖ' : '‚¨ú';
      
      itemsHtml += `<div class="project-item" style="flex-direction:column;align-items:stretch;">
        <div style="display:flex;align-items:center;gap:8px;">
          <span class="project-check" style="cursor:pointer;" onclick="toggleTodo('${item.id}')">${check}</span>
          <span class="project-name" style="${isDone ? 'text-decoration:line-through;opacity:0.5;' : ''}">${item.text}</span>
          ${saved.sent ? '<span class="todo-sent-badge">‚úì Sent</span>' : ''}
        </div>`;

      if (!isDone) {
        const noteVal = saved.note || '';
        itemsHtml += `<input class="todo-note-input" 
          placeholder="Add notes and press Enter to notify Jimmy..."
          value="${noteVal.replace(/"/g, '&quot;')}"
          data-id="${item.id}" data-text="${item.text.replace(/"/g, '&quot;')}"
          onkeydown="if(event.key==='Enter')submitTodoNote(this)">`;
        if (saved.sent && saved.note) {
          itemsHtml += `<div class="todo-note-saved">Last sent: "${saved.note}"</div>`;
        }
      }
      itemsHtml += '</div>';
    });

    if (section.section === 'done') {
      leftHtml += itemsHtml;
    } else {
      rightHtml += itemsHtml;
    }
  });

  container.innerHTML = `<div>${leftHtml}</div><div>${rightHtml}</div>`;
}

function toggleTodo(id) {
  const state = loadTodoState();
  state[id] = state[id] || {};
  state[id].done = !state[id].done;
  saveTodoState(state);
  renderLaunchTodo();
}

function submitTodoNote(input) {
  const id = input.dataset.id;
  const text = input.dataset.text;
  const note = input.value.trim();
  if (!note) return;

  const state = loadTodoState();
  state[id] = state[id] || {};
  state[id].note = note;
  state[id].sent = true;
  state[id].sentAt = new Date().toISOString();
  saveTodoState(state);

  sendToJimmy(id, text, note);
  
  input.style.borderColor = 'var(--accent-green)';
  input.style.background = 'rgba(0,255,136,0.08)';
  setTimeout(() => {
    input.style.borderColor = '';
    input.style.background = '';
    renderLaunchTodo();
  }, 1500);
}

renderLaunchTodo();

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ACCESS CONTROL & WALLET SCANNER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const AC_API_BASE = 'https://decrypt-caretaker-production.up.railway.app';
const AC_CONTRACTS = {
  cipher: "0x85075b6E79FEB545F30e60151f467ff17FD3E8BB",
  tierGate: "0x08c7C46434B8d0c5cEa538278711df0051C0fCA1"
};
const AC_TIER_THRESHOLDS = { bronze: 100000, gold: 500000, diamond: 1300000 };
const AC_STRATEGY_NAMES = ['OTE Silver Bullet', 'FVG+IFVG', 'OTE Aggressive', 'OTE Conservative'];
const AC_ERC20_ABI = ["function balanceOf(address) view returns (uint256)"];
const AC_TIERGATE_ABI = ["function getUserTier(address) view returns (uint8)"];

let acProvider = null;
let acAccessRequests = [];
let acApprovedUsers = [];
let acWalletScanResults = [];

async function acInitProvider() {
  try {
    acProvider = new ethers.JsonRpcProvider('https://sepolia.base.org');
  } catch (e) {
    console.log('AC Provider init failed:', e);
  }
}
acInitProvider();

async function acRefreshRequests() {
  try {
    const res = await fetch(`${AC_API_BASE}/api/access-requests`);
    if (res.ok) {
      const data = await res.json();
      acAccessRequests = data.pending || [];
      acApprovedUsers = data.approved || [];
      acRenderRequests();
      acRenderApproved();
      acUpdateAccessStats();
    }
  } catch (e) {
    console.log('Failed to fetch requests:', e);
    acAccessRequests = [
      { id: 1, tvUsername: 'trader_mike', type: 'indicator', wallet: '0x1234...5678', tier: 1, holdings: 150000, timestamp: Date.now() - 3600000 },
      { id: 2, tvUsername: 'crypto_sarah', type: 'strategy', strategyId: 0, wallet: '0xabcd...ef01', tier: 2, holdings: 650000, timestamp: Date.now() - 7200000 }
    ];
    acRenderRequests();
  }
}

function acRenderRequests() {
  const tbody = document.getElementById('ac-requests-table');
  if (acAccessRequests.length === 0) {
    tbody.innerHTML = '<tr><td colspan="8" class="ac-empty-state">No pending requests</td></tr>';
    return;
  }
  tbody.innerHTML = acAccessRequests.map(req => {
    const tierClass = req.tier === 3 ? 'ac-tier-diamond' : req.tier === 2 ? 'ac-tier-gold' : 'ac-tier-bronze';
    const tierName = req.tier === 3 ? 'üíé Diamond' : req.tier === 2 ? 'ü•á Gold' : 'ü•â Bronze';
    const typeClass = req.type === 'indicator' ? 'ac-type-indicator' : 'ac-type-strategy';
    const typeText = req.type === 'indicator' ? 'Indicator' : `Strategy #${req.strategyId}`;
    const details = req.type === 'strategy' ? AC_STRATEGY_NAMES[req.strategyId] || 'Unknown' : 'PriceCipher';
    const timeAgo = acFormatTimeAgo(req.timestamp);
    return `<tr>
      <td class="ac-tv-username">@${req.tvUsername}</td>
      <td><span class="ac-request-type ${typeClass}">${typeText}</span></td>
      <td>${details}</td>
      <td class="ac-wallet-address">${req.wallet}</td>
      <td><span class="ac-tier-badge ${tierClass}">${tierName}</span></td>
      <td>${(req.holdings || 0).toLocaleString()} CIPHER</td>
      <td>${timeAgo}</td>
      <td>
        <button class="ac-action-btn approve" onclick="acApproveRequest(${req.id})">‚úì Approve</button>
        <button class="ac-action-btn reject" onclick="acRejectRequest(${req.id})">‚úó</button>
      </td>
    </tr>`;
  }).join('');
}

function acRenderApproved() {
  const tbody = document.getElementById('ac-approved-table');
  if (acApprovedUsers.length === 0) {
    tbody.innerHTML = '<tr><td colspan="7" class="ac-empty-state">No approved users yet</td></tr>';
    return;
  }
  tbody.innerHTML = acApprovedUsers.map(user => {
    const accessTypes = [];
    if (user.indicator) accessTypes.push('Indicator');
    if (user.strategies?.length) accessTypes.push(`${user.strategies.length} Strategies`);
    const accessText = accessTypes.join(' + ') || 'None';
    const holdingsOk = user.currentHoldings >= (user.requiredHoldings || 100000);
    const statusClass = holdingsOk ? 'ac-status-healthy' : 'ac-status-danger';
    const statusText = holdingsOk ? '‚úì Active' : '‚ö†Ô∏è Low Balance';
    return `<tr>
      <td class="ac-tv-username">@${user.tvUsername}</td>
      <td>${accessText}</td>
      <td class="ac-wallet-address">${user.wallet}</td>
      <td>${(user.currentHoldings || 0).toLocaleString()} CIPHER</td>
      <td><span class="ac-wallet-status ${statusClass}">${statusText}</span></td>
      <td>${acFormatDate(user.approvedAt)}</td>
      <td><button class="ac-action-btn reject" onclick="acRevokeAccess('${user.id}')">Revoke</button></td>
    </tr>`;
  }).join('');
}

async function acApproveRequest(id) {
  const req = acAccessRequests.find(r => r.id === id);
  if (!req) return;
  try {
    await fetch(`${AC_API_BASE}/api/access-requests/${id}/approve`, { method: 'POST' });
  } catch (e) {
    console.log('API call failed, proceeding anyway');
  }
  const action = req.type === 'indicator' ?
    'Add to PriceCipher indicator' :
    `Add to ${AC_STRATEGY_NAMES[req.strategyId]} strategy`;
  alert(`‚úÖ Approved!\n\nTradingView: @${req.tvUsername}\nAction: ${action}\n\nGo to TradingView and add this user to your private script.`);
  acAccessRequests = acAccessRequests.filter(r => r.id !== id);
  acRenderRequests();
}

async function acRejectRequest(id) {
  if (!confirm('Reject this request?')) return;
  try {
    await fetch(`${AC_API_BASE}/api/access-requests/${id}/reject`, { method: 'POST' });
  } catch (e) {}
  acAccessRequests = acAccessRequests.filter(r => r.id !== id);
  acRenderRequests();
}

async function acRevokeAccess(id) {
  if (!confirm('Revoke access for this user?')) return;
  try {
    await fetch(`${AC_API_BASE}/api/access-requests/${id}/revoke`, { method: 'POST' });
  } catch (e) {}
  acApprovedUsers = acApprovedUsers.filter(u => u.id !== id);
  acRenderApproved();
}

async function acScanAllWallets() {
  const btn = document.getElementById('acScanAllBtn');
  btn.disabled = true;
  btn.textContent = 'üîÑ Scanning...';
  const grid = document.getElementById('ac-scanner-grid');
  grid.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text-secondary);">Scanning wallets on Base Sepolia...</div>';
  acWalletScanResults = [];

  const usersToScan = acApprovedUsers.length > 0 ? acApprovedUsers : [
    { tvUsername: 'trader_mike', wallet: '0x1234567890abcdef1234567890abcdef12345678', type: 'indicator', requiredTier: 1 },
    { tvUsername: 'crypto_sarah', wallet: '0xabcdef1234567890abcdef1234567890abcdef12', type: 'strategy', strategyId: 0, requiredTier: 2 }
  ];

  for (const user of usersToScan) {
    try {
      let balance = 0;
      let tier = 0;
      if (acProvider && user.wallet && user.wallet.length === 42) {
        const cipher = new ethers.Contract(AC_CONTRACTS.cipher, AC_ERC20_ABI, acProvider);
        const tierGate = new ethers.Contract(AC_CONTRACTS.tierGate, AC_TIERGATE_ABI, acProvider);
        const rawBalance = await cipher.balanceOf(user.wallet);
        balance = Number(ethers.formatEther(rawBalance));
        tier = Number(await tierGate.getUserTier(user.wallet));
      } else {
        balance = Math.floor(Math.random() * 1500000);
        tier = balance >= 1300000 ? 3 : balance >= 500000 ? 2 : balance >= 100000 ? 1 : 0;
      }
      const requiredBalance = user.type === 'strategy' ? 500000 : 100000;
      const status = balance >= requiredBalance ? 'healthy' : balance >= requiredBalance * 0.5 ? 'warning' : 'danger';
      acWalletScanResults.push({ ...user, currentBalance: balance, currentTier: tier, requiredBalance, status });
    } catch (e) {
      console.log('Scan error for', user.wallet, e);
    }
  }
  acRenderScanResults();
  acUpdateScanStats();
  btn.disabled = false;
  btn.textContent = 'üîÑ Scan All Wallets';
}

function acRenderScanResults() {
  const grid = document.getElementById('ac-scanner-grid');
  if (acWalletScanResults.length === 0) {
    grid.innerHTML = '<div class="ac-empty-state"><div class="ac-empty-state-icon">üîç</div><div>No wallets to scan</div></div>';
    return;
  }
  grid.innerHTML = acWalletScanResults.map(w => {
    const tierName = w.currentTier === 3 ? 'üíé Diamond' : w.currentTier === 2 ? 'ü•á Gold' : w.currentTier === 1 ? 'ü•â Bronze' : '‚ùå None';
    const statusText = w.status === 'healthy' ? '‚úì Healthy' : w.status === 'warning' ? '‚ö†Ô∏è Low' : '‚ùå Below';
    return `<div class="ac-wallet-card ${w.status}">
      <div class="ac-wallet-header">
        <span class="ac-wallet-tv">@${w.tvUsername}</span>
        <span class="ac-wallet-status ac-status-${w.status}">${statusText}</span>
      </div>
      <div class="ac-wallet-details">
        <div class="ac-wallet-detail">
          <span class="ac-wallet-detail-label">Balance:</span>
          <span class="ac-wallet-detail-value">${w.currentBalance.toLocaleString()}</span>
        </div>
        <div class="ac-wallet-detail">
          <span class="ac-wallet-detail-label">Required:</span>
          <span class="ac-wallet-detail-value">${w.requiredBalance.toLocaleString()}</span>
        </div>
        <div class="ac-wallet-detail">
          <span class="ac-wallet-detail-label">Tier:</span>
          <span class="ac-wallet-detail-value">${tierName}</span>
        </div>
        <div class="ac-wallet-detail">
          <span class="ac-wallet-detail-label">Access:</span>
          <span class="ac-wallet-detail-value">${w.type === 'indicator' ? 'Indicator' : AC_STRATEGY_NAMES[w.strategyId] || 'Strategy'}</span>
        </div>
      </div>
      ${w.status === 'danger' ? `<div class="ac-wallet-actions">
        <button class="ac-action-btn reject" onclick="acAddToRevocation('${w.tvUsername}')">Add to Revocation</button>
      </div>` : ''}
    </div>`;
  }).join('');
}

function acUpdateScanStats() {
  const healthy = acWalletScanResults.filter(w => w.status === 'healthy').length;
  const warning = acWalletScanResults.filter(w => w.status === 'warning').length;
  const danger = acWalletScanResults.filter(w => w.status === 'danger').length;
  document.getElementById('ac-scan-total').textContent = acWalletScanResults.length;
  document.getElementById('ac-scan-healthy').textContent = healthy;
  document.getElementById('ac-scan-warning').textContent = warning;
  document.getElementById('ac-scan-danger').textContent = danger;
}

function acUpdateAccessStats() {
  document.getElementById('ac-pending').textContent = acAccessRequests.length;
  document.getElementById('ac-indicator').textContent = acApprovedUsers.filter(u => u.indicator).length;
  document.getElementById('ac-strategy').textContent = acApprovedUsers.filter(u => u.strategies?.length).length;
}

function acAddToRevocation(tvUsername) {
  alert(`‚ö†Ô∏è ${tvUsername} added to revocation queue. They will be notified.`);
}

function acFormatTimeAgo(timestamp) {
  const seconds = Math.floor((Date.now() - timestamp) / 1000);
  if (seconds < 60) return 'Just now';
  if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
  if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
  return `${Math.floor(seconds / 86400)}d ago`;
}

function acFormatDate(timestamp) {
  if (!timestamp) return '--';
  return new Date(timestamp).toLocaleDateString();
}

// Auto-load access requests when Decrypt Labs tab is shown
const origNavClick = document.querySelectorAll('.nav-tab');
origNavClick.forEach(tab => {
  tab.addEventListener('click', () => {
    if (tab.getAttribute('data-tab') === 'decrypt-labs') {
      acRefreshRequests();
    }
  });
});
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PERSONAL TASK CALENDAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DAYS_OF_WEEK = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
const CATEGORY_COLORS = {
  trading: '#00ff88',
  content: '#aa66ff',
  business: '#00d4ff',
  personal: '#ffdd44'
};

const DEFAULT_PERSONAL_TASKS = {
  Mon: [
    { name: 'Morning routine', time: '3:45 AM', cat: 'personal' },
    { name: 'Check bot performance', time: '6:00 AM', cat: 'trading' },
    { name: 'Weekly planning', time: '8:00 AM', cat: 'business' },
    { name: 'Review expenses', time: '9:00 AM', cat: 'business' },
    { name: 'Set weekly goals', time: '10:00 AM', cat: 'business' },
    { name: 'Review trades', time: '12:00 PM', cat: 'trading' },
    { name: 'Evening bot protocol', time: '4:00 PM', cat: 'trading' },
  ],
  Tue: [
    { name: 'Morning routine', time: '3:45 AM', cat: 'personal' },
    { name: 'Check bot performance', time: '6:00 AM', cat: 'trading' },
    { name: 'Market Analysis Post', time: '7:00 AM', cat: 'content' },
    { name: 'Review trades', time: '12:00 PM', cat: 'trading' },
    { name: 'Evening bot protocol', time: '4:00 PM', cat: 'trading' },
  ],
  Wed: [
    { name: 'Morning routine', time: '3:45 AM', cat: 'personal' },
    { name: 'Check bot performance', time: '6:00 AM', cat: 'trading' },
    { name: 'Content creation day', time: '9:00 AM', cat: 'content' },
    { name: 'Discord community', time: '11:00 AM', cat: 'content' },
    { name: 'Review trades', time: '12:00 PM', cat: 'trading' },
    { name: 'Evening bot protocol', time: '4:00 PM', cat: 'trading' },
  ],
  Thu: [
    { name: 'Morning routine', time: '3:45 AM', cat: 'personal' },
    { name: 'Check bot performance', time: '6:00 AM', cat: 'trading' },
    { name: 'Market Analysis Post', time: '7:00 AM', cat: 'content' },
    { name: 'Review bot strategies', time: '10:00 AM', cat: 'trading' },
    { name: 'Review trades', time: '12:00 PM', cat: 'trading' },
    { name: 'Evening bot protocol', time: '4:00 PM', cat: 'trading' },
  ],
  Fri: [
    { name: 'Morning routine', time: '3:45 AM', cat: 'personal' },
    { name: 'Check bot performance', time: '6:00 AM', cat: 'trading' },
    { name: 'Weekly P&L review', time: '9:00 AM', cat: 'business' },
    { name: 'Update dashboard data', time: '10:00 AM', cat: 'business' },
    { name: 'Review trades', time: '12:00 PM', cat: 'trading' },
    { name: 'Plan next week', time: '2:00 PM', cat: 'business' },
    { name: 'Evening bot protocol', time: '4:00 PM', cat: 'trading' },
  ],
  Sat: [
    { name: 'Light monitoring', time: '9:00 AM', cat: 'trading' },
    { name: 'Off / Rest day', time: '‚Äî', cat: 'personal' },
  ],
  Sun: [
    { name: 'Prep for trading week', time: '4:00 PM', cat: 'trading' },
    { name: 'Check news/events', time: '5:00 PM', cat: 'business' },
  ]
};

let personalTasks = null;
let personalEditOverlay = null;

function loadPersonalTasks() {
  try {
    const saved = localStorage.getItem('personal-tasks');
    return saved ? JSON.parse(saved) : JSON.parse(JSON.stringify(DEFAULT_PERSONAL_TASKS));
  } catch(e) { return JSON.parse(JSON.stringify(DEFAULT_PERSONAL_TASKS)); }
}

async function loadPersonalTasksFromAPI() {
  try {
    const res = await fetch('/api/personal-tasks');
    if (res.ok) {
      const data = await res.json();
      if (data && Object.keys(data).length > 0) {
        localStorage.setItem('personal-tasks', JSON.stringify(data));
        return data;
      }
    }
  } catch(e) { console.warn('API personal-tasks load failed, using localStorage'); }
  const local = loadPersonalTasks();
  if (local && Object.keys(local).length > 0) {
    fetch('/api/personal-tasks', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(local) }).catch(() => {});
  }
  return local;
}

async function savePersonalTasks() {
  localStorage.setItem('personal-tasks', JSON.stringify(personalTasks));
  try {
    await fetch('/api/personal-tasks', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(personalTasks) });
  } catch(e) { console.warn('Failed to save personal tasks to server'); }
}

function parseTimeToMinutes(timeStr) {
  if (!timeStr || timeStr === '‚Äî') return 9999;
  const match = timeStr.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);
  if (!match) return 9999;
  let h = parseInt(match[1]);
  const m = parseInt(match[2]);
  const ampm = match[3].toUpperCase();
  if (ampm === 'PM' && h < 12) h += 12;
  if (ampm === 'AM' && h === 12) h = 0;
  return h * 60 + m;
}

function renderPersonalCalendar() {
  if (!personalTasks) personalTasks = loadPersonalTasks();
  const grid = document.getElementById('personal-cal-grid');
  if (!grid) return;

  const now = new Date();
  const todayIdx = (now.getDay() + 6) % 7; // 0=Mon

  let html = '';
  DAYS_OF_WEEK.forEach((day, idx) => {
    const isToday = idx === todayIdx;
    const tasks = personalTasks[day] || [];
    html += '<div class="pcal-day' + (isToday ? ' pcal-today' : '') + '">';
    html += '<div class="pcal-day-header">' + day;
    if (isToday) html += ' <span class="pcal-today-badge">TODAY</span>';
    html += '</div>';
    html += '<div class="pcal-tasks">';
    tasks.forEach((task, ti) => {
      const catClass = 'cat-' + (task.cat || 'personal');
      html += '<div class="pcal-task ' + catClass + '" onclick="editPersonalTask(\'' + day + '\',' + ti + ')">';
      html += '<div class="pcal-task-name">' + escapeHtml(task.name) + '</div>';
      html += '<div class="pcal-task-time">' + escapeHtml(task.time || '') + '</div>';
      html += '</div>';
    });
    html += '<button class="pcal-add-btn" onclick="addPersonalTask(\'' + day + '\')">+</button>';
    html += '</div></div>';
  });
  grid.innerHTML = html;
  renderPersonalNextUp();
}

function escapeHtml(str) {
  const d = document.createElement('div');
  d.textContent = str;
  return d.innerHTML;
}

function editPersonalTask(day, idx) {
  const task = personalTasks[day][idx];
  showTaskEditModal(day, idx, task);
}

function addPersonalTask(day) {
  showTaskEditModal(day, -1, { name: '', time: '', cat: 'personal' });
}

function showTaskEditModal(day, idx, task) {
  let overlay = document.getElementById('pcal-edit-overlay');
  if (!overlay) {
    overlay = document.createElement('div');
    overlay.id = 'pcal-edit-overlay';
    overlay.className = 'pcal-edit-overlay';
    overlay.innerHTML = '<div class="pcal-edit-modal" id="pcal-edit-modal"></div>';
    overlay.addEventListener('click', (e) => { if (e.target === overlay) closeTaskEditModal(); });
    document.body.appendChild(overlay);
  }

  const isNew = idx === -1;
  const modal = document.getElementById('pcal-edit-modal');
  modal.innerHTML = `
    <h3>${isNew ? '‚ûï Add Task' : '‚úèÔ∏è Edit Task'} ‚Äî ${day}</h3>
    <label>Task Name</label>
    <input type="text" id="pcal-edit-name" value="${escapeHtml(task.name)}" placeholder="Task name...">
    <label>Time</label>
    <input type="text" id="pcal-edit-time" value="${escapeHtml(task.time || '')}" placeholder="e.g. 9:00 AM">
    <label>Category</label>
    <select id="pcal-edit-cat">
      <option value="trading" ${task.cat==='trading'?'selected':''}>üü¢ Trading/Bots</option>
      <option value="content" ${task.cat==='content'?'selected':''}>üü£ Content/Social</option>
      <option value="business" ${task.cat==='business'?'selected':''}>üîµ Business/Admin</option>
      <option value="personal" ${task.cat==='personal'?'selected':''}>üü° Personal</option>
    </select>
    <div class="pcal-edit-actions">
      ${!isNew ? '<button class="pcal-delete-btn" onclick="deletePersonalTask(\''+day+'\','+idx+')">üóë</button>' : ''}
      <button class="pcal-cancel-btn" onclick="closeTaskEditModal()">CANCEL</button>
      <button class="pcal-save-btn" onclick="saveTaskEdit(\'${day}\',${idx})">SAVE</button>
    </div>
  `;

  overlay.classList.add('active');
  setTimeout(() => document.getElementById('pcal-edit-name').focus(), 100);
}

function closeTaskEditModal() {
  const overlay = document.getElementById('pcal-edit-overlay');
  if (overlay) overlay.classList.remove('active');
}

function saveTaskEdit(day, idx) {
  const name = document.getElementById('pcal-edit-name').value.trim();
  const time = document.getElementById('pcal-edit-time').value.trim();
  const cat = document.getElementById('pcal-edit-cat').value;

  if (!name) return;

  if (!personalTasks[day]) personalTasks[day] = [];

  const task = { name, time: time || '‚Äî', cat };

  if (idx === -1) {
    personalTasks[day].push(task);
  } else {
    personalTasks[day][idx] = task;
  }

  // Sort by time
  personalTasks[day].sort((a, b) => parseTimeToMinutes(a.time) - parseTimeToMinutes(b.time));

  savePersonalTasks();
  renderPersonalCalendar();
  closeTaskEditModal();
}

function deletePersonalTask(day, idx) {
  if (!personalTasks[day]) return;
  personalTasks[day].splice(idx, 1);
  savePersonalTasks();
  renderPersonalCalendar();
  closeTaskEditModal();
}

function renderPersonalNextUp() {
  const container = document.getElementById('personal-countdown-list');
  if (!container) return;

  const now = new Date();
  const currentDay = (now.getDay() + 6) % 7; // 0=Mon
  const currentMinutes = now.getHours() * 60 + now.getMinutes();

  // Collect upcoming tasks from today and next 7 days
  let upcoming = [];
  for (let offset = 0; offset < 7; offset++) {
    const dayIdx = (currentDay + offset) % 7;
    const dayName = DAYS_OF_WEEK[dayIdx];
    const tasks = personalTasks[dayName] || [];
    tasks.forEach(task => {
      const taskMin = parseTimeToMinutes(task.time);
      if (taskMin >= 9999) return; // skip tasks with no time
      let minutesUntil;
      if (offset === 0) {
        minutesUntil = taskMin - currentMinutes;
        if (minutesUntil <= 0) return; // already passed today
      } else {
        minutesUntil = (offset * 1440) + taskMin - currentMinutes;
      }
      upcoming.push({ ...task, minutesUntil, dayName });
    });
  }

  upcoming.sort((a, b) => a.minutesUntil - b.minutesUntil);
  upcoming = upcoming.slice(0, 8);

  if (upcoming.length === 0) {
    container.innerHTML = '<div class="personal-next-item"><span style="color:var(--text-dim);">No upcoming tasks</span></div>';
    return;
  }

  container.innerHTML = upcoming.map(t => {
    const color = CATEGORY_COLORS[t.cat] || '#888';
    let timeStr;
    if (t.minutesUntil < 60) {
      timeStr = 'in ' + t.minutesUntil + ' min';
    } else if (t.minutesUntil < 1440) {
      const h = Math.floor(t.minutesUntil / 60);
      const m = t.minutesUntil % 60;
      timeStr = 'in ' + h + 'h ' + m + 'm';
    } else {
      const d = Math.floor(t.minutesUntil / 1440);
      const h = Math.floor((t.minutesUntil % 1440) / 60);
      timeStr = 'in ' + d + 'd ' + h + 'h';
    }
    return '<div class="personal-next-item">' +
      '<div class="personal-next-label"><span class="dot" style="background:' + color + ';"></span> <strong>' + escapeHtml(t.name) + '</strong></div>' +
      '<div class="personal-next-value">' + timeStr + '</div></div>';
  }).join('');
}

// Initialize personal calendar when tab is shown
loadPersonalTasksFromAPI().then(data => {
  personalTasks = data;
  renderPersonalCalendar();
});

// Update next-up countdowns every minute
setInterval(() => {
  if (document.getElementById('tab-personal')?.classList.contains('active')) {
    renderPersonalNextUp();
  }
}, 60000);

// Also render when personal tab is clicked
document.querySelectorAll('.nav-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    if (tab.getAttribute('data-tab') === 'personal') {
      renderPersonalCalendar();
    }
  });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê IDEAS LAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DEFAULT_IDEAS = [
  { id: 1, title: 'Polymarket Arbitrage Scanner', desc: 'Scan Polymarket API for arbitrage opportunities across prediction markets', status: 'backlog', category: 'trading', priority: 'hot', created: '2026-01-27' },
  { id: 2, title: '$CIPHER Token Launch', desc: 'Launch on Virtuals Protocol ‚Äî buyback from bot profits', status: 'in-progress', category: 'token', priority: 'hot', created: '2026-01-25' },
  { id: 3, title: 'ICT Indicator Landing Page', desc: 'Marketing site for the indicator ‚Äî pricing tiers, strategy breakdowns', status: 'in-progress', category: 'product', priority: 'hot', created: '2026-01-24' },
  { id: 4, title: 'YouTube Channel', desc: 'Bot performance videos, ICT education, transparent trading journey', status: 'backlog', category: 'content', priority: 'normal', created: '2026-02-01' },
  { id: 5, title: 'Pitch Video for Investors', desc: 'Professional video showcasing Decrypt Labs, bot performance, roadmap', status: 'in-progress', category: 'product', priority: 'hot', created: '2026-02-05' },
  { id: 6, title: 'AR Glasses Dashboard', desc: 'Real-time bot stats on XREAL One Pro glasses via web overlay', status: 'backlog', category: 'product', priority: 'normal', created: '2026-01-27' },
  { id: 7, title: 'Auto Tweet Pipeline Expansion', desc: 'Add chart screenshots, trade results, and win streak posts to auto-tweet flow', status: 'in-progress', category: 'content', priority: 'normal', created: '2026-02-09' },
  { id: 8, title: 'Multi-Exchange Bridge', desc: 'Expand beyond Apex/Tradovate ‚Äî support NinjaTrader, Rithmic', status: 'backlog', category: 'trading', priority: 'normal', created: '2026-02-03' },
];

let ideasData = [...DEFAULT_IDEAS];
let nextIdeaId = 100;

async function loadIdeas() {
  try {
    const res = await fetch('/api/ideas');
    if (res.ok) {
      const data = await res.json();
      if (Array.isArray(data) && data.length > 0) {
        ideasData = data;
        nextIdeaId = Math.max(...data.map(i => i.id || 0)) + 1;
        localStorage.setItem('decrypt-ideas', JSON.stringify(data));
        return;
      }
    }
  } catch(e) {}
  const saved = localStorage.getItem('decrypt-ideas');
  if (saved) { try { ideasData = JSON.parse(saved); nextIdeaId = Math.max(...ideasData.map(i => i.id || 0)) + 1; } catch(e) {} }
}

async function saveIdeas() {
  localStorage.setItem('decrypt-ideas', JSON.stringify(ideasData));
  try { await fetch('/api/ideas', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(ideasData) }); } catch(e) {}
}

function renderIdeas() {
  const grid = document.getElementById('ideas-grid');
  if (!grid) return;
  const filter = document.getElementById('idea-filter')?.value || 'all';
  let filtered = ideasData;
  if (filter !== 'all') {
    filtered = ideasData.filter(i => i.status === filter || i.category === filter || i.priority === filter);
  }
  // Sort: hot first, then by created desc
  filtered.sort((a, b) => {
    if (a.priority === 'hot' && b.priority !== 'hot') return -1;
    if (b.priority === 'hot' && a.priority !== 'hot') return 1;
    return (b.created || '').localeCompare(a.created || '');
  });

  const statusColors = { 'hot': '#ff6b6b', 'backlog': '#6c7a89', 'in-progress': '#f39c12', 'done': '#2ecc71' };
  const statusLabels = { 'hot': 'üî• Hot', 'backlog': 'üìã Backlog', 'in-progress': 'üöß In Progress', 'done': '‚úÖ Done' };
  const catEmoji = { 'trading': 'üìà', 'content': 'üé¨', 'product': 'üõ†Ô∏è', 'token': 'ü™ô' };

  grid.innerHTML = filtered.map(idea => `
    <div style="background:#141824;border:1px solid #2a2e3e;border-radius:12px;padding:16px;position:relative;border-left:4px solid ${statusColors[idea.status] || '#6c7a89'};">
      <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:8px;">
        <span style="font-size:11px;padding:3px 8px;border-radius:4px;background:${statusColors[idea.status] || '#6c7a89'}22;color:${statusColors[idea.status] || '#6c7a89'};font-weight:600;">${statusLabels[idea.status] || idea.status}</span>
        <span style="font-size:11px;color:#666;">${catEmoji[idea.category] || 'üí°'} ${idea.category || 'general'}</span>
      </div>
      <h3 style="color:#e0e0e0;font-size:15px;margin:0 0 6px 0;font-weight:700;" contenteditable="true" onblur="updateIdea(${idea.id},'title',this.textContent)">${idea.title}</h3>
      <p style="color:#888;font-size:12px;margin:0 0 10px 0;line-height:1.4;" contenteditable="true" onblur="updateIdea(${idea.id},'desc',this.textContent)">${idea.desc}</p>
      <div style="display:flex;gap:6px;flex-wrap:wrap;">
        <select onchange="updateIdea(${idea.id},'status',this.value);renderIdeas()" style="background:#1a1e2e;color:#aaa;border:1px solid #2a2e3e;padding:3px 6px;border-radius:4px;font-size:11px;">
          ${['backlog','in-progress','done'].map(s => `<option value="${s}" ${idea.status===s?'selected':''}>${statusLabels[s]}</option>`).join('')}
        </select>
        <select onchange="updateIdea(${idea.id},'category',this.value);renderIdeas()" style="background:#1a1e2e;color:#aaa;border:1px solid #2a2e3e;padding:3px 6px;border-radius:4px;font-size:11px;">
          ${['trading','content','product','token'].map(c => `<option value="${c}" ${idea.category===c?'selected':''}>${catEmoji[c]} ${c}</option>`).join('')}
        </select>
        <button onclick="toggleHot(${idea.id})" style="background:none;border:1px solid #2a2e3e;padding:3px 8px;border-radius:4px;font-size:11px;cursor:pointer;color:${idea.priority==='hot'?'#ff6b6b':'#666'};">${idea.priority==='hot'?'üî•':'‚òÜ'}</button>
        <button onclick="deleteIdea(${idea.id})" style="background:none;border:1px solid #2a2e3e;padding:3px 8px;border-radius:4px;font-size:11px;cursor:pointer;color:#666;">üóë</button>
      </div>
      <div style="color:#555;font-size:10px;margin-top:8px;">${idea.created || ''}</div>
    </div>
  `).join('');
}

function addIdea() {
  const idea = { id: nextIdeaId++, title: 'New Idea', desc: 'Describe it here...', status: 'backlog', category: 'product', priority: 'normal', created: new Date().toISOString().split('T')[0] };
  ideasData.unshift(idea);
  saveIdeas();
  renderIdeas();
}

function updateIdea(id, field, value) {
  const idea = ideasData.find(i => i.id === id);
  if (idea) { idea[field] = value.trim(); saveIdeas(); }
}

function toggleHot(id) {
  const idea = ideasData.find(i => i.id === id);
  if (idea) { idea.priority = idea.priority === 'hot' ? 'normal' : 'hot'; saveIdeas(); renderIdeas(); }
}

function deleteIdea(id) {
  if (!confirm('Delete this idea?')) return;
  ideasData = ideasData.filter(i => i.id !== id);
  saveIdeas();
  renderIdeas();
}

// Load and render on init
loadIdeas().then(() => renderIdeas());
</script>
</div><!-- end #app-content -->
</body>
</html>
